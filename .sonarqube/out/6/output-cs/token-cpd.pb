ó4
gC:\Users\Matthieu\source\repos\HeroBot-deux-point-z√©ro\HeroBot.Core\Helpers\ServiceCollectionHelper.cs
	namespace 	
HeroBot
 
. 
Core 
. 
Helpers 
{ 
public 

static 
class #
ServiceCollectionHelper /
{ 
public 
static 
IServiceCollection (1
%LoadAllServicesFromExternalAssembiles) N
(N O
thisO S
IServiceCollectionT f
servicesg o
)o p
{ 	
var #
serviceProviderMigrateg '
=( )!
CreateserviceMigrator* ?
(? @
typeof@ F
(F G 
Migration1_270720191G [
)[ \
.\ ]
Assembly] e
)e f
;f g
using 
( 
var 
scope 
= #
serviceProviderMigrateg 6
.6 7
CreateScope7 B
(B C
)C D
)D E
{ 
( 
scope 
as 
IServiceProvider *
)* +
.+ ,
GetRequiredService, >
<> ?
IMigrationRunner? O
>O P
(P Q
)Q R
.R S
	MigrateUpS \
(\ ]
)] ^
;^ _
}   
ModulesService"" 
."" &
LoadAssembliesInDirrectory"" 5
(""5 6
)""6 7
;""7 8
List## 
<## 
Assembly## 
>## 
ass## 
=##  
new##! $
List##% )
<##) *
Assembly##* 2
>##2 3
(##3 4
)##4 5
;##5 6
foreach%% 
(%% 
dynamic%% 
assembly%% %
in%%& (
ModulesService%%) 7
.%%7 8
GetLoadedAssemblies%%8 K
(%%K L
)%%L M
)%%M N
{&& 
ass'' 
.'' 
Add'' 
('' 
assembly''  
.''  !
ass''! $
)''$ %
;''% &
}(( 
foreach** 
(** 
dynamic** 
assembly** %
in**& (
ModulesService**) 7
.**7 8
GetLoadedAssemblies**8 K
(**K L
)**L M
)**M N
{++ 
try,, 
{-- 
var.. 
assm.. 
=.. 
(..  
(..  !
Assembly..! )
)..) *
(..* +
assembly..+ 3
...3 4
ass..4 7
)..7 8
)..8 9
;..9 :
var// "
serviceProviderMigrate// .
=/// 0!
CreateserviceMigrator//1 F
(//F G
assm//G K
)//K L
;//L M
using11 
(11 
var11 
scope11 $
=11% &"
serviceProviderMigrate11' =
.11= >
CreateScope11> I
(11I J
)11J K
)11K L
{22 
(33 
scope33 
as33 !
IServiceProvider33" 2
)332 3
.333 4
GetRequiredService334 F
<33F G
IMigrationRunner33G W
>33W X
(33X Y
)33Y Z
.33Z [
	MigrateUp33[ d
(33d e
)33e f
;33f g
}44 
}55 
catch66 
{66 
}66J K
}77 
foreach99 
(99 
Assembly99 
assm99 "
in99# %
ass99& )
)99) *
{:: 
IEnumerable;; 
<;; 
TypeInfo;; $
>;;$ %
servicesAss;;& 1
=;;2 3
assm;;4 8
.;;8 9
DefinedTypes;;9 E
.;;E F
Where;;F K
(;;K L
x;;L M
=>;;N P
!;;Q R
x;;R S
.;;S T
IsInterface;;T _
&&;;` b
!;;c d
x;;d e
.;;e f
IsEnum;;f l
&&;;m o
x;;p q
.;;q r
IsClass;;r y
&&;;z |
x;;} ~
.;;~ 
IsPublic	;; á
&&
;;à ä
x
;;ã å
.
;;å ç
Name
;;ç ë
.
;;ë í
Contains
;;í ö
(
;;ö õ
$str
;;õ §
)
;;§ •
)
;;• ¶
;
;;¶ ß
if<< 
(<< 
servicesAss<< 
.<<  
Any<<  #
(<<# $
)<<$ %
)<<% &
{== 
foreach>> 
(>> 
TypeInfo>> %
typeInfo>>& .
in>>/ 1
servicesAss>>2 =
)>>= >
{?? 
services@@  
.@@  !
AddSingleton@@! -
(@@- .
assm@@. 2
.@@2 3
GetTypes@@3 ;
(@@; <
)@@< =
.@@= >
FirstOrDefault@@> L
(@@L M
x@@M N
=>@@O Q
x@@R S
.@@S T
Name@@T X
==@@Y [
typeInfo@@\ d
.@@d e
Name@@e i
)@@i j
)@@j k
;@@k l
}AA 
}BB 
}CC 
returnDD 
servicesDD 
;DD 
}EE 	
privateKK 
staticKK 
ServiceProviderKK &!
CreateserviceMigratorKK' <
(KK< =
AssemblyKK= E
assemblyKKF N
)KKN O
{LL 	
varMM 
collMM 
=MM 
newMM 
ServiceCollectionMM ,
(MM, -
)MM- .
;MM. /
collNN 
.NN !
AddFluentMigratorCoreNN &
(NN& '
)NN' (
.NN( )
ConfigureRunnerNN) 8
(NN8 9
(NN9 :
xNN: ;
)NN; <
=>NN= ?
{OO 
xPP 
.PP 
AddPostgresPP 
(PP 
)PP 
.QQ &
WithGlobalConnectionStringQQ +
(QQ+ ,
$"QQ, .<
0Server=ssh.alivecreation.fr;Port=26257;Database=QQ. ^
{QQ^ _
assemblyQQ_ g
.QQg h
GetNameQQh o
(QQo p
)QQp q
.QQq r
NameQQr v
}QQv wg
Z;User Id=matthieu;Password=4d9*jC%(hu\"ecN2&;SslMode=Require;Trust Server Certificate=true	QQw —
"
QQ— “
)
QQ“ ”
.RR 
ScanInRR 
(RR 
assemblyRR  
)RR  !
.RR! "
ForRR" %
.RR% &

MigrationsRR& 0
(RR0 1
)RR1 2
;RR2 3
}SS 
)SS 
;SS 
returnTT 
collTT 
.TT  
BuildServiceProviderTT ,
(TT, -
)TT- .
;TT. /
}UU 	
}VV 
}XX ’
eC:\Users\Matthieu\source\repos\HeroBot-deux-point-z√©ro\HeroBot.Core\Helpers\ServiceProviderHelper.cs
	namespace		 	
HeroBot		
 
.		 
Core		 
.		 
Helpers		 
{

 
public 

static 
class !
ServiceProviderHelper -
{ 
public 
static 
ServiceProvider %0
$GetAllServicesFromExternalAssemblies& J
(J K
thisK O
ServiceProviderP _
services` h
)h i
{ 	
foreach 
( 
dynamic 
d 
in !
ModulesService" 0
.0 1
GetLoadedAssemblies1 D
(D E
)E F
)F G
{ 
Assembly 
ass 
= 
d  
.  !
ass! $
;$ %
IEnumerable 
< 
TypeInfo $
>$ %
servicesAss& 1
=2 3
ass4 7
.7 8
DefinedTypes8 D
.D E
WhereE J
(J K
xK L
=>M O
!P Q
xQ R
.R S
IsInterfaceS ^
&&_ a
!b c
xc d
.d e
IsEnume k
&&l n
xo p
.p q
IsClassq x
&&y {
x| }
.} ~
IsPublic	~ Ü
&&
á â
x
ä ã
.
ã å
Name
å ê
.
ê ë
Contains
ë ô
(
ô ö
$str
ö £
)
£ §
)
§ •
;
• ¶
if 
( 
servicesAss 
.  
Any  #
(# $
)$ %
)% &
{ 
foreach 
( 
TypeInfo %
typeInfo& .
in/ 1
servicesAss2 =
)= >
{ 
services  
.  !
GetRequiredService! 3
(3 4
ass4 7
.7 8
GetTypes8 @
(@ A
)A B
.B C
FirstOrDefaultC Q
(Q R
xR S
=>T V
xW X
.X Y
NameY ]
==^ `
typeInfoa i
.i j
Namej n
)n o
)o p
;p q
} 
} 
} 
return   
services   
;   
}!! 	
}"" 
}## ≠
gC:\Users\Matthieu\source\repos\HeroBot-deux-point-z√©ro\HeroBot.Core\Migrations\Migration1_270720191.cs
	namespace 	
HeroBot
 
. 
Core 
. 

Migrations !
{ 
[ 
	Migration 
( 
$num 
) 
] 
public		 

class		  
Migration1_270720191		 %
:		& '
	Migration		( 1
{

 
public 
override 
void 
Down !
(! "
)" #
{ 	
Delete 
. 
Table 
( 
$str "
)" #
;# $
} 	
public 
override 
void 
Up 
(  
)  !
{ 	
Create 
. 
Table 
( 
$str "
)" #
. 

WithColumn 
( 
$str  
)  !
.! "
AsInt32" )
() *
)* +
.+ ,
Identity, 4
(4 5
)5 6
.6 7

PrimaryKey7 A
(A B
)B C
. 

WithColumn 
( 
$str "
)" #
.# $
AsString$ ,
(, -
)- .
.. /
Unique/ 5
(5 6
)6 7
;7 8
Create 
. 
Table 
( 
$str !
)! "
. 

WithColumn 
( 
$str  
)  !
.! "
AsInt32" )
() *
)* +
.+ ,
Identity, 4
(4 5
)5 6
.6 7

PrimaryKey7 A
(A B
)B C
;C D
Create 
. 
Table 
( 
$str &
)& '
. 

WithColumn 
( 
$str  
)  !
.! "
AsInt32" )
() *
)* +
.+ ,
Identity, 4
(4 5
)5 6
.6 7

PrimaryKey7 A
(A B
)B C
. 

WithColumn 
( 
$str #
)# $
.$ %
AsInt32% ,
(, -
)- .
.. /

ForeignKey/ 9
(9 :
$str: B
,B C
$strD H
)H I
. 

WithColumn 
( 
$str $
)$ %
.% &
AsInt32& -
(- .
). /
./ 0

ForeignKey0 :
(: ;
$str; D
,D E
$strF J
)J K
;K L
} 	
} 
} “
OC:\Users\Matthieu\source\repos\HeroBot-deux-point-z√©ro\HeroBot.Core\Program.cs
	namespace 	
	HeroBotv2
 
{ 
static 

class 
Program 
{ 
public 
static 
Task 
Main 
(  
)  !
=>		 
Startup		 
.		 
RunAsync		 
(		  
)		  !
;		! "
}

 
} ƒM
_C:\Users\Matthieu\source\repos\HeroBot-deux-point-z√©ro\HeroBot.Core\Services\CommandHandler.cs
	namespace 	
	HeroBotv2
 
. 
Services 
{ 
public 

class 
CommandHandler 
{ 
private 
readonly  
DiscordShardedClient -
_discord. 6
;6 7
private 
readonly 
CommandService '
	_commands( 1
;1 2
private 
readonly 
IConfigurationRoot +
_config, 3
;3 4
private 
readonly 
IServiceProvider )
	_provider* 3
;3 4
private 
readonly 
CooldownService (
	_cooldown) 2
;2 3
public 
CommandHandler 
(  
DiscordShardedClient  
discord! (
,( )
CommandService 
commands #
,# $
IConfigurationRoot 
config %
,% &
IServiceProvider 
provider %
,% &
CooldownService 
cooldownService +
)+ ,
{ 	
	_cooldown 
= 
cooldownService '
;' (
_discord 
= 
discord 
; 
	_commands   
=   
commands    
;    !
_config!! 
=!! 
config!! 
;!! 
	_provider"" 
="" 
provider""  
;""  !
_discord$$ 
.$$ 
MessageReceived$$ $
+=$$% '"
OnMessageReceivedAsync$$( >
;$$> ?
_discord%% 
.%% 
MessageUpdated%% #
+=%%$ &
OnMessageUpdated%%' 7
;%%7 8
}&& 	
private(( 
Task(( 
OnMessageUpdated(( %
(((% &
	Cacheable((& /
<((/ 0
IMessage((0 8
,((8 9
ulong((: ?
>((? @

oldMessage((A K
,((K L
SocketMessage((M Z

newMessage(([ e
,((e f!
ISocketMessageChannel((g |
messageChannel	((} ã
)
((ã å
{)) 	
return** "
OnMessageReceivedAsync** )
(**) *

newMessage*** 4
)**4 5
;**5 6
}++ 	
private-- 
async-- 
Task-- "
OnMessageReceivedAsync-- 1
(--1 2
SocketMessage--2 ?
s--@ A
)--A B
{.. 	
var// 
msg// 
=// 
s// 
as// 
SocketUserMessage// ,
;//, -
if00 
(00 
msg00 
==00 
null00 
)00 
return00 #
;00# $
if11 
(11 
msg11 
.11 
Author11 
.11 
Id11 
==11  
_discord11! )
.11) *
CurrentUser11* 5
.115 6
Id116 8
||119 ;
msg11< ?
.11? @
Author11@ F
.11F G
IsBot11G L
)11L M
return11N T
;11T U
if22 
(22 
!22 
(22 
msg22 
.22 
Channel22 
is22  
SocketGuildChannel22! 3
)223 4
)224 5
return226 <
;22< =
var33 
context33 
=33 
new33  
SocketCommandContext33 2
(332 3
_discord333 ;
.33; <
GetShardFor33< G
(33G H
(33H I
msg33I L
.33L M
Channel33M T
as33U W
SocketGuildChannel33X j
)33j k
.33k l
Guild33l q
)33q r
,33r s
msg33t w
)33w x
;33x y
int44 
argPos44 
=44 
$num44 
;44 
if55 
(55 
msg55 
.55 
HasStringPrefix55 #
(55# $
_config55$ +
[55+ ,
$str55, 4
]554 5
,555 6
ref557 :
argPos55; A
)55A B
||55C E
msg55F I
.55I J
HasMentionPrefix55J Z
(55Z [
_discord55[ c
.55c d
CurrentUser55d o
,55o p
ref55q t
argPos55u {
)55{ |
)55| }
{66 
var77 
command77 
=77 
	_commands77 '
.77' (
Search77( .
(77. /
context77/ 6
,776 7
argPos778 >
)77> ?
;77? @
if88 
(88 
command88 
.88 
	IsSuccess88 %
)88% &
{88' (
var:: 
cmd:: 
=:: 
command:: %
.::% &
Commands::& .
.::. /
First::/ 4
(::4 5
)::5 6
.::6 7
Command::7 >
;::> ?
var;; 
result;; 
=;;  
await;;! &
	_commands;;' 0
.;;0 1
ExecuteAsync;;1 =
(;;= >
context;;> E
,;;E F
argPos;;G M
,;;M N
	_provider;;O X
);;X Y
;;;Y Z
if<< 
(<< 
!<< 
result<< 
.<<  
	IsSuccess<<  )
)<<) *
{== 
switch>> 
(>>  
result>>  &
.>>& '
Error>>' ,
)>>, -
{?? 
case@@  
CommandError@@! -
.@@- .
BadArgCount@@. 9
:@@9 :
awaitAA  %
sAA& '
.AA' (
ChannelAA( /
.AA/ 0
SendMessageAsyncAA0 @
(AA@ A
$"AAA CL
?Oops, it look like you made a syntax error in your command :/ `	AAC Ç
{
AAÇ É
_config
AAÉ ä
[
AAä ã
$str
AAã ì
]
AAì î
}
AAî ï
{
AAï ñ
(
AAñ ó
cmd
AAó ö
.
AAö õ
Aliases
AAõ ¢
.
AA¢ £
Count
AA£ ®
>
AA© ™
$num
AA´ ¨
?
AA≠ Æ
$"
AAØ ±
{
AA± ≤
$str
AA≤ µ
}
AAµ ∂
{
AA∂ ∑
string
AA∑ Ω
.
AAΩ æ
Join
AAæ ¬
(
AA¬ √
$str
AA√ ∆
,
AA∆ «
cmd
AA» À
.
AAÀ Ã
Aliases
AAÃ ”
)
AA” ‘
}
AA‘ ’
{
AA’ ÷
$str
AA÷ Ÿ
}
AAŸ ⁄
"
AA⁄ €
:
AA‹ ›
cmd
AAﬁ ·
.
AA· ‚
Name
AA‚ Ê
)
AAÊ Á
}
AAÁ Ë
{
AAÈ Í
string
AAÍ 
.
AA Ò
Join
AAÒ ı
(
AAı ˆ
$str
AAˆ ˘
,
AA˘ ˙
cmd
AA˚ ˛
.
AA˛ ˇ

Parameters
AAˇ â
.
AAâ ä
Select
AAä ê
(
AAê ë
p
AAë í
=>
AAì ï
p
AAñ ó
.
AAó ò

IsOptional
AAò ¢
?
AA£ §
$"
AA• ß
[
AAß ®
{
AA® ©
p
AA© ™
.
AA™ ´
Name
AA´ Ø
}
AAØ ∞
{
AA∞ ±
(
AA± ≤
p
AA≤ ≥
.
AA≥ ¥
IsRemainder
AA¥ ø
?
AA¿ ¡
$str
AA¬ «
:
AA» …
String
AA  –
.
AA– —
Empty
AA— ÷
)
AA÷ ◊
}
AA◊ ÿ
]
AAÿ Ÿ
"
AAŸ ⁄
:
AA€ ‹
$"
AA› ﬂ
<
AAﬂ ‡
{
AA‡ ·
p
AA· ‚
.
AA‚ „
Name
AA„ Á
}
AAÁ Ë
{
AAË È
(
AAÈ Í
p
AAÍ Î
.
AAÎ Ï
IsRemainder
AAÏ ˜
?
AA¯ ˘
$str
AA˙ ˇ
:
AAÄ Å
String
AAÇ à
.
AAà â
Empty
AAâ é
)
AAé è
}
AAè ê
>
AAê ë
"
AAë í
)
AAí ì
)
AAì î
}
AAî ï
`
AAï ñ
"
AAñ ó
)
AAó ò
;
AAò ô
breakBB  %
;BB% &
caseCC  
CommandErrorCC! -
.CC- .
ParseFailedCC. 9
:CC9 :
awaitDD  %
sDD& '
.DD' (
ChannelDD( /
.DD/ 0
SendMessageAsyncDD0 @
(DD@ A
$strDDA s
)DDs t
;DDt u
breakEE  %
;EE% &
caseFF  
CommandErrorFF! -
.FF- .
UnmetPreconditionFF. ?
:FF? @
awaitGG  %
sGG& '
.GG' (
ChannelGG( /
.GG/ 0
SendMessageAsyncGG0 @
(GG@ A
$"GGA CA
5Oops, it look like you are not allowed to do this ! `GGC x
{GGx y
resultGGy 
.	GG Ä
ErrorReason
GGÄ ã
}
GGã å
`
GGå ç
"
GGç é
)
GGé è
;
GGè ê
breakHH  %
;HH% &
caseII  
CommandErrorII! -
.II- .
	ExceptionII. 7
:II7 8
awaitJJ  %
sJJ& '
.JJ' (
ChannelJJ( /
.JJ/ 0
SendMessageAsyncJJ0 @
(JJ@ A
$strJJA e
)JJe f
;JJf g
breakKK  %
;KK% &
defaultLL #
:LL# $
awaitMM  %
sMM& '
.MM' (
ChannelMM( /
.MM/ 0
SendMessageAsyncMM0 @
(MM@ A
$"MMA C
Unknown error `MMC R
{MMR S
resultMMS Y
}MMY Z
`MMZ [
"MM[ \
)MM\ ]
;MM] ^
breakNN  %
;NN% &
}OO 
}QQ 
elseRR 
awaitSS 
	_cooldownSS '
.SS' (
	OnCommandSS( 1
(SS1 2
commandSS2 9
.SS9 :
CommandsSS: B
.SSB C
FirstSSC H
(SSH I
)SSI J
.SSJ K
CommandSSK R
,SSR S
contextSST [
)SS[ \
;SS\ ]
}TT 
}UU 
}VV 	
}WW 
}XX ˚.
`C:\Users\Matthieu\source\repos\HeroBot-deux-point-z√©ro\HeroBot.Core\Services\CooldownService.cs
	namespace 	
HeroBot
 
. 
Core 
. 
Services 
{		 
public

 

class

 
CooldownService

  
:

! "
ICooldownService

# 3
{ 
private 
readonly 
IRedisService &
_redis' -
;- .
public 
CooldownService 
( 
IRedisService ,
redisService- 9
)9 :
{; <
CooldownAttribute 
. 
	_cooldown '
=( )
this* .
;. /
_redis 
= 
redisService !
;! "
} 	
public 
async 
Task 
< 
TimeSpan "
?" #
># $
IsCommandCooldowned% 8
(8 9
ulong9 >
userid? E
,E F
stringG M
commandNameN Y
)Y Z
{ 	
return 
( 
await 
_redis  
.  !
GetDatabase! ,
(, -
)- .
.. /$
StringGetWithExpiryAsync/ G
(G H
$"H J
{J K
useridK Q
}Q R
-c-R U
{U V
commandNameV a
}a b
"b c
)c d
)d e
.e f
Expiryf l
;l m
} 	
public 
async 
Task 
< 
TimeSpan "
?" #
># $
IsModuleCooldowned% 7
(7 8
ulong8 =
userid> D
,D E
stringF L

moduleNameM W
)W X
{ 	
return 
( 
await 
_redis $
.$ %
GetDatabase% 0
(0 1
)1 2
.2 3$
StringGetWithExpiryAsync3 K
(K L
$"L N
{N O
useridO U
}U V
-m-V Y
{Y Z

moduleNameZ d
}d e
"e f
)f g
)g h
.h i
Expiryi o
;o p
} 	
internal 
async 
Task 
	OnCommand %
(% &
CommandInfo& 1
commandInfo2 =
,= > 
SocketCommandContext> R
commandContextS a
)a b
{c d
if 
( 
commandInfo 
. 
Preconditions )
.) *
Any* -
(- .
x. /
=>0 2
x3 4
is5 7
CooldownAttribute8 I
)I J
)J K
{L M
var 
seconds 
= 
( 
commandInfo *
.* +
Preconditions+ 8
.8 9
Where9 >
(> ?
x? @
=>A C
xD E
isF H
CooldownAttributeI Z
)Z [
.[ \
OrderByDescending\ m
(m n
xn o
=>p r
(s t
xt u
asv x
CooldownAttribute	y ä
)
ä ã
.
ã å
cooldown
å î
.
î ï
Seconds
ï ú
)
ú ù
.
ù û
First
û £
(
£ §
)
§ •
as
¶ ®
CooldownAttribute
© ∫
)
∫ ª
.
ª º
cooldown
º ƒ
;
ƒ ≈
await   
_redis   
.   
GetDatabase   (
(  ( )
)  ) *
.  * +
StringSetAsync  + 9
(  9 :
$"  : <
{  < =
commandContext  = K
.  K L
User  L P
.  P Q
Id  Q S
}  S T
-c-  T W
{  W X
commandInfo  X c
.  c d
Name  d h
}  h i
"  i j
,  j k
String  l r
.  r s
Empty  s x
,  x y
seconds	  z Å
)
  Å Ç
;
  Ç É
}!! 
if"" 
("" 
commandInfo"" 
."" 
Module"" "
.""" #
Preconditions""# 0
.""0 1
Any""1 4
(""4 5
x""5 6
=>""7 9
x"": ;
is""< >
CooldownAttribute""? P
)""P Q
)""Q R
{""S T
var## 
seconds## 
=## 
(## 
commandInfo## *
.##* +
Module##+ 1
.##1 2
Preconditions##2 ?
.##? @
Where##@ E
(##E F
x##F G
=>##H J
x##K L
is##M O
CooldownAttribute##P a
)##a b
.##b c
OrderByDescending##c t
(##t u
x##u v
=>##w y
(##z {
x##{ |
as##} 
CooldownAttribute
##Ä ë
)
##ë í
.
##í ì
cooldown
##ì õ
.
##õ ú
Seconds
##ú £
)
##£ §
.
##§ •
First
##• ™
(
##™ ´
)
##´ ¨
as
##≠ Ø
CooldownAttribute
##∞ ¡
)
##¡ ¬
.
##¬ √
cooldown
##√ À
;
##À Ã
await$$ 
_redis$$ 
.$$ 
GetDatabase$$ (
($$( )
)$$) *
.$$* +
StringSetAsync$$+ 9
($$9 :
$"$$: <
{$$< =
commandContext$$= K
.$$K L
User$$L P
.$$P Q
Id$$Q S
}$$S T
-m-$$T W
{$$W X
commandInfo$$X c
.$$c d
Module$$d j
.$$j k
Name$$k o
}$$o p
"$$p q
,$$q r
String$$s y
.$$y z
Empty$$z 
,	$$ Ä
seconds
$$Ä á
)
$$á à
;
$$à â
}%% 
}&& 	
}'' 
}(( î*
_C:\Users\Matthieu\source\repos\HeroBot-deux-point-z√©ro\HeroBot.Core\Services\HeroBotContext.cs
	namespace 	
HeroBot
 
. 
Core 
. 
Services 
{ 
public 

class 
HeroBotContext 
:  !
IDatabaseService" 2
{ 
private 
readonly 
IConfigurationRoot +
_config, 3
;3 4
public 
HeroBotContext 
( 
IConfigurationRoot 0
confg1 6
)6 7
{ 	
_config 
= 
confg 
; 
NeedPluginAttribute 
.  
databaseService  /
=0 1
this2 6
;6 7
} 	
public 
IDbConnection 
GetDbConnection ,
(, -
)- .
{ 	

StackTrace 

stackTrace !
=" #
new$ '

StackTrace( 2
(2 3
)3 4
;4 5

StackFrame 
[ 
] 
stackFrames $
=% &

stackTrace' 1
.1 2
	GetFrames2 ;
(; <
)< =
;= >
var 
assembly 
= 
stackFrames &
[& '
$num' (
]( )
.) *
	GetMethod* 3
(3 4
)4 5
.5 6
DeclaringType6 C
.C D
AssemblyD L
;L M
return 
new 
Npgsql 
. 
NpgsqlConnection .
(. /
$"/ 1
Server=1 8
{8 9
_config9 @
.@ A

GetSectionA K
(K L
$strL V
)V W
.W X

GetSectionX b
(b c
$strc i
)i j
.j k
Valuek p
}p q
;Port=q w
{w x
_configx 
.	 Ä

GetSection
Ä ä
(
ä ã
$str
ã ï
)
ï ñ
.
ñ ó

GetSection
ó °
(
° ¢
$str
¢ ®
)
® ©
.
© ™
Value
™ Ø
}
Ø ∞

;Database=
∞ ∫
{
∫ ª
assembly
ª √
.
√ ƒ
GetName
ƒ À
(
À Ã
)
Ã Õ
.
Õ Œ
Name
Œ “
}
“ ”
	;User Id=
” ‹
{
‹ ›
_config
› ‰
.
‰ Â

GetSection
Â Ô
(
Ô 
$str
 ˙
)
˙ ˚
.
˚ ¸

GetSection
¸ Ü
(
Ü á
$str
á ç
)
ç é
.
é è

GetSection
è ô
(
ô ö
$str
ö †
)
† °
.
° ¢
Value
¢ ß
}
ß ®

;Password=
® ≤
{
≤ ≥
_config
≥ ∫
.
∫ ª

GetSection
ª ≈
(
≈ ∆
$str
∆ –
)
– —
.
— “

GetSection
“ ‹
(
‹ ›
$str
› „
)
„ ‰
.
‰ Â

GetSection
Â Ô
(
Ô 
$str
 ˙
)
˙ ˚
.
˚ ¸
Value
¸ Å
}
Å ÇK
=;SslMode=Require;Trust Server Certificate=true;Pooling=false;
Ç ø
"
ø ¿
)
¿ ¡
;
¡ ¬
} 	
public!! 
IDbConnection!! 
GetDbConnection!! ,
(!!, -
string!!- 3
v!!4 5
)!!5 6
{"" 	
return## 
new## 
Npgsql## 
.## 
NpgsqlConnection## .
(##. /
$"##/ 1
Server=##1 8
{##8 9
_config##9 @
.##@ A

GetSection##A K
(##K L
$str##L V
)##V W
.##W X

GetSection##X b
(##b c
$str##c i
)##i j
.##j k
Value##k p
}##p q
;Port=##q w
{##w x
_config##x 
.	## Ä

GetSection
##Ä ä
(
##ä ã
$str
##ã ï
)
##ï ñ
.
##ñ ó

GetSection
##ó °
(
##° ¢
$str
##¢ ®
)
##® ©
.
##© ™
Value
##™ Ø
}
##Ø ∞

;Database=
##∞ ∫
{
##∫ ª
v
##ª º
}
##º Ω
	;User Id=
##Ω ∆
{
##∆ «
_config
##« Œ
.
##Œ œ

GetSection
##œ Ÿ
(
##Ÿ ⁄
$str
##⁄ ‰
)
##‰ Â
.
##Â Ê

GetSection
##Ê 
(
## Ò
$str
##Ò ˜
)
##˜ ¯
.
##¯ ˘

GetSection
##˘ É
(
##É Ñ
$str
##Ñ ä
)
##ä ã
.
##ã å
Value
##å ë
}
##ë í

;Password=
##í ú
{
##ú ù
_config
##ù §
.
##§ •

GetSection
##• Ø
(
##Ø ∞
$str
##∞ ∫
)
##∫ ª
.
##ª º

GetSection
##º ∆
(
##∆ «
$str
##« Õ
)
##Õ Œ
.
##Œ œ

GetSection
##œ Ÿ
(
##Ÿ ⁄
$str
##⁄ ‰
)
##‰ Â
.
##Â Ê
Value
##Ê Î
}
##Î ÏK
=;SslMode=Require;Trust Server Certificate=true;Pooling=false;
##Ï ©
"
##© ™
)
##™ ´
;
##´ ¨
}$$ 	
}%% 
}&& æ"
_C:\Users\Matthieu\source\repos\HeroBot-deux-point-z√©ro\HeroBot.Core\Services\LoggingService.cs
	namespace 	
	HeroBotv2
 
. 
Services 
{ 
public 

class 
LoggingService 
{ 
public 
LoggingService 
(  
DiscordShardedClient 2
discord3 :
,: ;
CommandService< J
commandsK S
)S T
{ 	
discord 
. 
Log 
+= 

OnLogAsync %
;% &
commands 
. 
Log 
+= 

OnLogAsync &
;& '
} 	
public 
void 
Log 
( 
LogSeverity #
logSeverity$ /
,/ 0
string1 7
message8 ?
)? @
{A B

StackTrace 

stackTrace !
=" #
new$ '

StackTrace( 2
(2 3
)3 4
;4 5

StackFrame 
[ 
] 
stackFrames $
=% &

stackTrace' 1
.1 2
	GetFrames2 ;
(; <
)< =
;= >
var 
assembly 
= 
stackFrames &
[& '
$num' (
]( )
.) *
	GetMethod* 3
(3 4
)4 5
.5 6
DeclaringType6 C
.C D
AssemblyD L
;L M
DisplayLogAsync 
( 
new 

LogMessage  *
(* +
logSeverity+ 6
,6 7
assembly8 @
.@ A
GetNameA H
(H I
)I J
.J K
NameK O
,O P
messageP W
)W X
)X Y
.Y Z
WaitZ ^
(^ _
)_ `
;` a
} 	
private 
async 
Task 

OnLogAsync %
(% &

LogMessage& 0
msg1 4
)4 5
{   	

StackTrace!! 

stackTrace!! !
=!!" #
new!!$ '

StackTrace!!( 2
(!!2 3
)!!3 4
;!!4 5

StackFrame"" 
["" 
]"" 
stackFrames"" $
=""% &

stackTrace""' 1
.""1 2
	GetFrames""2 ;
(""; <
)""< =
;""= >
var$$ 
assembly$$ 
=$$ 
stackFrames$$ &
[$$& '
$num$$' (
]$$( )
.$$) *
	GetMethod$$* 3
($$3 4
)$$4 5
.$$5 6
DeclaringType$$6 C
.$$C D
Assembly$$D L
;$$L M
await&& 
DisplayLogAsync&& !
(&&! "
new&&" %

LogMessage&&& 0
(&&0 1
msg&&1 4
.&&4 5
Severity&&5 =
,&&= >
assembly&&? G
.&&G H
GetName&&H O
(&&O P
)&&P Q
.&&Q R
Name&&R V
,&&V W
msg&&X [
.&&[ \
Message&&\ c
,&&c d
msg&&e h
.&&h i
	Exception&&i r
)&&r s
)&&s t
;&&t u
}'' 	
private)) 
Task)) 
DisplayLogAsync)) $
())$ %

LogMessage))% /
msg))0 3
)))3 4
{))5 6
string** 
logText** 
=** 
$"** 
{**  
DateTime**  (
.**( )
UtcNow**) /
.**/ 0
ToString**0 8
(**8 9
$str**9 C
)**C D
}**D E
 [**E G
{**G H
msg**H K
.**K L
Severity**L T
}**T U
] **U W
{**W X
msg**X [
.**[ \
Source**\ b
}**b c
: **c e
{**e f
msg**f i
.**i j
	Exception**j s
?**s t
.**t u
ToString**u }
(**} ~
)**~ 
??
**Ä Ç
msg
**É Ü
.
**Ü á
Message
**á é
}
**é è
"
**è ê
;
**ê ë
return++ 
Console++ 
.++ 
Out++ 
.++ 
WriteLineAsync++ -
(++- .
logText++. 5
)++5 6
;++6 7
},, 	
}-- 
}.. Ω
_C:\Users\Matthieu\source\repos\HeroBot-deux-point-z√©ro\HeroBot.Core\Services\ModulesService.cs
	namespace 	
HeroBot
 
. 
Core 
. 
Services 
{ 
public 

sealed 
class 
ModulesService &
{ 
private 
readonly 
IServiceProvider )
	_provider* 3
;3 4
private 
readonly 
IDatabaseService )
	_database* 3
;3 4
private 
readonly 
CommandService '
_commandService( 7
;7 8
private 
readonly 
LoggingService '
_logging( 0
;0 1
private 
readonly  
ConcurrentDictionary -
<- .
string. 4
,4 5
ContextEntity6 C
>C D
	_contextsE N
;N O
private 
static 
readonly 
List  $
<$ %
dynamic% ,
>, -
LoadedAssemblies. >
=? @
newA D
ListE I
<I J
dynamicJ Q
>Q R
(R S
)S T
;T U
public 
ModulesService 
( 
CommandService ,
commandService- ;
,; <
IServiceProvider= M
providerN V
,V W
LoggingServiceX f
loggingServiceg u
,u v
IDatabaseService	w á
databaseService
à ó
)
ó ò
{ 	
	_provider   
=   
provider    
;    !
	_database!! 
=!! 
databaseService!! '
;!!' (
_commandService"" 
="" 
commandService"" ,
;"", -
_logging## 
=## 
loggingService## %
;##% &
	_contexts$$ 
=$$ 
new$$  
ConcurrentDictionary$$ 0
<$$0 1
string$$1 7
,$$7 8
ContextEntity$$9 F
>$$F G
($$G H
)$$H I
;$$I J#
FetchExternalAssemblies&& #
(&&# $
)&&$ %
;&&% &
}'' 	
internal)) 
static)) 
IEnumerable)) #
<))# $
dynamic))$ +
>))+ ,
GetLoadedAssemblies))- @
())@ A
)))A B
{** 	
return++ 
LoadedAssemblies++ #
;++# $
},, 	
internal.. 
static.. 
void.. &
LoadAssembliesInDirrectory.. 7
(..7 8
)..8 9
{// 	
var00 
path00 
=00 
Path00 
.00 
Combine00 #
(00# $
	Directory00$ -
.00- .
GetCurrentDirectory00. A
(00A B
)00B C
,00C D
$str00E N
)00N O
;00O P
if22 
(22 
!22 
	Directory22 
.22 
Exists22 !
(22! "
path22" &
)22& '
)22' (
	Directory33 
.33 
CreateDirectory33 )
(33) *
path33* .
)33. /
;33/ 0
var55 
files55 
=55 
	Directory55 !
.55! "
EnumerateFiles55" 0
(550 1
path551 5
)555 6
.556 7
Where557 <
(55< =
x55= >
=>55? A
x55B C
.55C D
Contains55D L
(55L M
$str55M ^
)55^ _
)55_ `
;55` a
foreach66 
(66 
var66 
file66 
in66  
files66! &
)66& '
{77 
if88 
(88 
!88 
file88 
.88 
Contains88 "
(88" #
$str88# )
)88) *
)88* +
continue99 
;99 
var;; 
moduleContext;; !
=;;" #
new;;$ '
ModuleLoadContext;;( 9
(;;9 :
);;: ;
;;;; <
var<< 
ass<< 
=<< 
moduleContext<< '
.<<' ( 
LoadFromAssemblyPath<<( <
(<<< =
file<<= A
)<<A B
;<<B C
LoadedAssemblies==  
.==  !
Add==! $
(==$ %
new==% (
{==) *
ass==+ .
,==. /
moduleContext==0 =
}==> ?
)==? @
;==@ A
Console>> 
.>> 
	WriteLine>> !
(>>! "
$">>" $
Loaded >>$ +
{>>+ ,
ass>>, /
.>>/ 0
GetName>>0 7
(>>7 8
)>>8 9
}>>9 :
 v>>: <
{>>< =
ass>>= @
.>>@ A
GetName>>A H
(>>H I
)>>I J
.>>J K
Version>>K R
}>>R S

 assembly.>>S ]
">>] ^
)>>^ _
;>>_ `
}?? 
}@@ 	
privateBB 
voidBB #
FetchExternalAssembliesBB ,
(BB, -
)BB- .
{CC 	
foreachEE 
(EE 
dynamicEE 
assEE  
inEE! #
LoadedAssembliesEE$ 4
)EE4 5
{FF 
varGG 
nameGG 
=GG 
(GG 
(GG 
StringGG #
)GG# $
assGG$ '
.GG' (
assGG( +
.GG+ ,
GetNameGG, 3
(GG3 4
)GG4 5
.GG5 6
NameGG6 :
)GG: ;
.GG; <
SanitizAssemblyGG< K
(GGK L
)GGL M
;GGM N
varII 
classesRefferalII #
=II$ %
(II& '
assII' *
.II* +
assII+ .
asII/ 1
AssemblyII2 :
)II: ;
.II; <
DefinedTypesII< H
.IIH I
WhereIII N
(IIN O
xIIO P
=>IIQ S
!IIT U
xIIU V
.IIV W
IsInterfaceIIW b
&&IIc e
xIIf g
.IIg h
IsPublicIIh p
&&IIq s
!IIt u
xIIu v
.IIv w

IsAbstract	IIw Å
&&
IIÇ Ñ
x
IIÖ Ü
.
IIÜ á
Name
IIá ã
==
IIå é
$str
IIè ü
)
IIü †
;
II† °
ifKK 
(KK 
classesRefferalKK #
.KK# $
AnyKK$ '
(KK' (
)KK( )
)KK) *
{LL 
varMM 
instanceMM  
=MM! "
(MM# $
IPluginRefferalMM$ 3
)MM3 4
classesRefferalMM4 C
.MMC D
FirstMMD I
(MMI J
)MMJ K
.MMK L
GetConstructorsMML [
(MM[ \
)MM\ ]
.MM] ^
FirstMM^ c
(MMc d
)MMd e
.MMe f
InvokeMMf l
(MMl m
newMMm p
objectMMq w
[MMw x
]MMx y
{MMz {
}MM| }
)MM} ~
;MM~ 
varPP 
contextPP 
=PP  !
newPP" %
ContextEntityPP& 3
{QQ 
NameRR 
=RR 
nameRR #
,RR# $
ContextSS 
=SS  !
assSS" %
.SS% &
moduleContextSS& 3
,SS3 4
AssemblyTT  
=TT! "
assTT# &
.TT& '
assTT' *
,TT* +
pluginRefferalUU &
=UU' (
instanceUU) 1
}VV 
;VV 
ifWW 
(WW 
	_contextsWW !
.WW! "
ContainsKeyWW" -
(WW- .
nameWW. 2
)WW2 3
)WW3 4
continueXX  
;XX  !
	_contextsZZ 
.ZZ 
TryAddZZ $
(ZZ$ %
nameZZ% )
,ZZ) *
contextZZ+ 2
)ZZ2 3
;ZZ3 4
_logging[[ 
.[[ 
Log[[  
([[  !
LogSeverity[[! ,
.[[, -
Info[[- 1
,[[1 2
$"[[3 5
Loaded [[5 <
{[[< =
name[[= A
}[[A B
 v[[B D
{[[D E
ass[[E H
.[[H I
ass[[I L
.[[L M
GetName[[M T
([[T U
)[[U V
.[[V W
Version[[W ^
}[[^ _
 assembly modules.[[_ q
"[[q r
)[[r s
;[[s t
if^^ 
(^^ 
	_contexts^^ !
.^^! "
IsEmpty^^" )
)^^) *
break__ 
;__ 
}`` 
}aa 
}cc 	
publicee 
asyncee 
Taskee #
TempUnloadAssemblyAsyncee 1
(ee1 2
stringee2 8
assemblyNameee9 E
)eeE F
{ff 	
ifgg 
(gg 
!gg 
	_contextsgg 
.gg 
TryGetValuegg &
(gg& '
assemblyNamegg' 3
,gg3 4
outgg5 8
vargg9 <
contextgg= D
)ggD E
)ggE F
returnhh 
;hh 
varjj 
checkjj 
=jj 
awaitjj 
_commandServicejj -
.jj- .
RemoveModuleAsyncjj. ?
(jj? @
contextjj@ G
.jjG H
ModulejjH N
)jjN O
;jjO P
ifkk 
(kk 
!kk 
checkkk 
)kk 
{ll 
_loggingmm 
.mm 
Logmm 
(mm 
LogSeveritymm (
.mm( )
Errormm) .
,mm. /
$"mm0 2
Failed to unload mm2 C
{mmC D
contextmmD K
.mmK L
NamemmL P
}mmP Q
 module.mmQ Y
"mmY Z
)mmZ [
;mm[ \
returnnn 
;nn 
}oo 
contextqq 
.qq 
Contextqq 
.qq 
Unloadqq "
(qq" #
)qq# $
;qq$ %
_loggingrr 
.rr 
Logrr 
(rr 
LogSeverityrr $
.rr$ %
Inforr% )
,rr) *
$"rr+ -
	Unloaded rr- 6
{rr6 7
contextrr7 >
.rr> ?
Namerr? C
}rrC D

 assembly.rrD N
"rrN O
)rrO P
;rrP Q
}ss 	
publicuu 
asyncuu 
Taskuu 
LoadAssemblyAsyncuu +
(uu+ ,
stringuu, 2
assemblyNameuu3 ?
)uu? @
{vv 	
ifww 
(ww 
!ww 
	_contextsww 
.ww 
TryGetValueww &
(ww& '
assemblyNameww' 3
,ww3 4
outww5 8
varww9 <
contextww= D
)wwD E
)wwE F
returnxx 
;xx 
contextzz 
.zz 
Contextzz 
.zz  
LoadFromAssemblyNamezz 0
(zz0 1
contextzz1 8
.zz8 9
Assemblyzz9 A
.zzA B
GetNamezzB I
(zzI J
)zzJ K
)zzK L
;zzL M
await{{ 
_commandService{{ !
.{{! "
AddModulesAsync{{" 1
({{1 2
context{{2 9
.{{9 :
Assembly{{: B
,{{B C
	_provider{{D M
){{M N
;{{N O
_logging}} 
.}} 
Log}} 
(}} 
LogSeverity}} $
.}}$ %
Info}}% )
,}}) *
$"}}+ -
Loaded }}- 4
{}}4 5
context}}5 <
.}}< =
Name}}= A
}}}A B

 assembly.}}B L
"}}L M
)}}M N
;}}N O
}~~ 	
public
ÄÄ 
async
ÄÄ 
Task
ÄÄ ,
LoadModulesFromAssembliesAsync
ÄÄ 8
(
ÄÄ8 9
)
ÄÄ9 :
{
ÅÅ 	
using
ÇÇ 
(
ÇÇ 
var
ÇÇ 
db
ÇÇ 
=
ÇÇ 
(
ÇÇ 
NpgsqlConnection
ÇÇ -
)
ÇÇ- .
	_database
ÇÇ. 7
.
ÇÇ7 8
GetDbConnection
ÇÇ8 G
(
ÇÇG H
)
ÇÇH I
)
ÇÇI J
{
ÉÉ 
db
ÑÑ 
.
ÑÑ 
Open
ÑÑ 
(
ÑÑ 
)
ÑÑ 
;
ÑÑ 
var
ÜÜ 
plugins
ÜÜ 
=
ÜÜ 
await
ÜÜ #
db
ÜÜ$ &
.
ÜÜ& '

QueryAsync
ÜÜ' 1
(
ÜÜ1 2

getPlugins
ÜÜ2 <
)
ÜÜ< =
;
ÜÜ= >
foreach
ââ 
(
ââ 
var
ââ 
context
ââ $
in
ââ% '
	_contexts
ââ( 1
.
ââ1 2
Values
ââ2 8
)
ââ8 9
{
ää 
var
ãã 
	addModule
ãã !
=
ãã" #
await
ãã$ )
_commandService
ãã* 9
.
ãã9 :
AddModulesAsync
ãã: I
(
ããI J
context
ããJ Q
.
ããQ R
Assembly
ããR Z
,
ããZ [
	_provider
ãã\ e
)
ããe f
;
ããf g
context
åå 
.
åå 
Module
åå "
=
åå# $
	addModule
åå% .
.
åå. /
FirstOrDefault
åå/ =
(
åå= >
)
åå> ?
;
åå? @
if
çç 
(
çç 
context
çç 
.
çç  
Module
çç  &
.
çç& '
Preconditions
çç' 4
.
çç4 5
Any
çç5 8
(
çç8 9
x
çç9 :
=>
çç; =
x
çç> ?
is
çç@ B!
NeedPluginAttribute
ççC V
)
ççV W
)
ççW X
{
éé 
var
èè 
pluginid
èè $
=
èè% &
$num
èè' )
;
èè) *
	_contexts
êê !
.
êê! "
	TryUpdate
êê" +
(
êê+ ,
context
êê, 3
.
êê3 4
Name
êê4 8
,
êê8 9
context
êê: A
,
êêA B
context
êêC J
)
êêJ K
;
êêK L
if
íí 
(
íí 
!
íí 
plugins
íí $
.
íí$ %
Any
íí% (
(
íí( )
x
íí) *
=>
íí+ -
x
íí. /
.
íí/ 0
Name
íí0 4
==
íí5 7
context
íí8 ?
.
íí? @
Module
íí@ F
.
ííF G
Name
ííG K
)
ííK L
)
ííL M
{
ìì 
Console
îî #
.
îî# $
	WriteLine
îî$ -
(
îî- .
$str
îî. <
+
îî= >
context
îî? F
.
îîF G
Module
îîG M
.
îîM N
Name
îîN R
)
îîR S
;
îîS T
pluginid
ïï $
=
ïï% &
(
ïï' (
long
ïï( ,
)
ïï, -
await
ïï- 2
db
ïï3 5
.
ïï5 6 
ExecuteScalarAsync
ïï6 H
(
ïïH I
new
ïïI L
CommandDefinition
ïïM ^
(
ïï^ _
pluginInsert
ïï_ k
,
ïïk l
new
ïïm p
{
ññ 
name
óó  $
=
óó% &
context
óó' .
.
óó. /
Module
óó/ 5
.
óó5 6
Name
óó6 :
}
òò 
)
òò 
)
òò 
;
òò  
}
öö 
else
õõ 
{
úú 
pluginid
ùù $
=
ùù% &
plugins
ùù' .
.
ùù. /
First
ùù/ 4
(
ùù4 5
x
ùù5 6
=>
ùù7 9
x
ùù: ;
.
ùù; <
Name
ùù< @
==
ùùA C
context
ùùD K
.
ùùK L
Module
ùùL R
.
ùùR S
Name
ùùS W
)
ùùW X
.
ùùX Y
Id
ùùY [
;
ùù[ \
}
ûû 
if
üü 
(
üü 
RuntimeConstants
üü ,
.
üü, -
MasterPluginId
üü- ;
==
üü< >
null
üü? C
&&
üüD F
context
üüG N
.
üüN O
Module
üüO U
.
üüU V
Name
üüV Z
==
üü[ ]
$str
üü^ l
)
üül m
{
†† 
RuntimeConstants
¢¢ ,
.
¢¢, -
MasterPluginId
¢¢- ;
=
¢¢< =
pluginid
¢¢> F
;
¢¢F G
}
££ 
}
§§ 
}
•• 
}
¶¶ 
}
ßß 	
private
©© 
readonly
©© 
string
©© 
pluginInsert
©©  ,
=
©©- .
$str
©©/ t
;
©©t u
private
™™ 
readonly
™™ 
string
™™ 

getPlugins
™™  *
=
™™+ ,
$str
™™- H
;
™™H I
}
´´ 
}≠≠ ¿,
]C:\Users\Matthieu\source\repos\HeroBot-deux-point-z√©ro\HeroBot.Core\Services\RedisService.cs
	namespace 	
	HeroBotv2
 
. 
Services 
{ 
public 

class 
RedisService 
: 
IRedisService  -
{ 
private 
readonly 
LoggingService '
_loggingService( 7
;7 8
private 
readonly 
IConfigurationRoot +
_config, 3
;3 4
private 
ISubscriber 
_subscriber '
;' (
private 
IDatabaseAsync 
	_database (
;( )
public 
RedisService 
( 
LoggingService *
loggingService+ 9
,9 :
IConfigurationRoot; M
configurationRootN _
)_ `
{a b
_loggingService 
= 
loggingService ,
;, -
_config 
= 
configurationRoot '
;' (
BeginConnection 
( 
) 
; 
} 	
private 
void 
BeginConnection $
($ %
)% &
{ 	
var 
config 
= 
new  
ConfigurationOptions 1
(1 2
)2 3
;3 4
config 
. 

ClientName 
= 
$str  4
;4 5
config 
. 
Password 
= 
_config %
.% &

GetSection& 0
(0 1
$str1 8
)8 9
.9 :

GetSection: D
(D E
$strE K
)K L
.L M

GetSectionM W
(W X
$strX b
)b c
.c d
Valued i
;i j
config 
. 
DefaultDatabase "
=# $
int% (
.( )
Parse) .
(. /
_config/ 6
.6 7

GetSection7 A
(A B
$strB I
)I J
.J K

GetSectionK U
(U V
$strV `
)` a
.a b
Valueb g
)g h
;h i
config 
. 
	EndPoints 
. 
Add  
(  !
$"! #
{# $
_config$ +
.+ ,

GetSection, 6
(6 7
$str7 >
)> ?
.? @

GetSection@ J
(J K
$strK Q
)Q R
.R S
ValueS X
}X Y
:Y Z
{Z [
_config[ b
.b c

GetSectionc m
(m n
$strn u
)u v
.v w

GetSection	w Å
(
Å Ç
$str
Ç à
)
à â
.
â ä
Value
ä è
}
è ê
"
ê ë
)
ë í
;
í ì
var   
redis   
=   !
ConnectionMultiplexer   -
.  - .
Connect  . 5
(  5 6
config  6 <
)  < =
;  = >
redis!! 
.!! 
ConnectionFailed!! "
+=!!# %
(!!& '
sender!!' -
,!!- .
evcent!!. 4
)!!4 5
=>!!6 8
{!!9 :
_loggingService"" 
.""  
Log""  #
(""# $
Discord""$ +
.""+ ,
LogSeverity"", 7
.""7 8
Error""8 =
,""= >
$str""? \
)""\ ]
;""] ^
}## 
;## 
redis$$ 
.$$ 
ConnectionRestored$$ $
+=$$% '
($$( )
sender$$) /
,$$/ 0
evcent$$1 7
)$$7 8
=>$$9 ;
{$$< =
_loggingService%% 
.%%  
Log%%  #
(%%# $
Discord%%$ +
.%%+ ,
LogSeverity%%, 7
.%%7 8
Warning%%8 ?
,%%? @
$str%%A c
)%%c d
;%%d e
}&& 
;&& 
_subscriber'' 
='' 
redis'' 
.''  
GetSubscriber''  -
(''- .
)''. /
;''/ 0
_loggingService(( 
.(( 
Log(( 
(((  
Discord((  '
.((' (
LogSeverity((( 3
.((3 4
Info((4 8
,((8 9
$str((: X
)((X Y
;((Y Z
	_database)) 
=)) 
redis)) 
.)) 
GetDatabase)) )
())) *
int))* -
.))- .
Parse)). 3
())3 4
_config))4 ;
.)); <

GetSection))< F
())F G
$str))G N
)))N O
[))O P
$str))P Z
]))Z [
)))[ \
,))\ ]
new))^ a
object))b h
{))i j
}))k l
)))l m
;))m n
_loggingService** 
.** 
Log** 
(**  
Discord**  '
.**' (
LogSeverity**( 3
.**3 4
Info**4 8
,**8 9
$str**: Y
)**Y Z
;**Z [
}++ 	
public-- 
ISubscriber-- 
GetSubscriber-- (
(--( )
)--) *
{.. 	
return// 
_subscriber// 
;// 
}00 	
public22 
IDatabaseAsync22 
GetDatabase22 )
(22) *
)22* +
{33 	
return44 
	_database44 
;44 
}55 	
}66 
}77 ù=
_C:\Users\Matthieu\source\repos\HeroBot-deux-point-z√©ro\HeroBot.Core\Services\StartupService.cs
	namespace 	
	HeroBotv2
 
. 
Services 
{ 
public 

class 
StartupService 
{ 
private 
readonly 
IServiceProvider )
	_provider* 3
;3 4
private 
readonly  
DiscordShardedClient -
_discord. 6
;6 7
private 
readonly 
CommandService '
	_commands( 1
;1 2
private 
readonly 
IConfigurationRoot +
_config, 3
;3 4
private 
int 
[ 
] 
ShardPresences $
;$ %
private 
readonly 
string 
[  
]  !
presence" *
=+ ,
new- 0
[0 1
]1 2
{3 4
$str 
, 
$str !
,! "
$str +
,+ ,
$str #
,# $
$str *
,* +
$str  
} 	
;	 

private 
Task 
UpdatePresences $
{ 	
get 
{   
return!! 
new!! 
Task!! 
(!!  
async!!  %
(!!& '
)!!' (
=>!!) +
{"" 
while## 
(## 
true## 
)##  
{$$ 
await%% 
Task%% "
.%%" #
Delay%%# (
(%%( )
$num%%) .
)%%. /
;%%/ 0
foreach&& 
(&&  !
DiscordSocketClient&&! 4
discordSocketClient&&5 H
in&&I K
_discord&&L T
.&&T U
Shards&&U [
)&&[ \
{'' 
if(( 
(((  
discordSocketClient((  3
.((3 4
ConnectionState((4 C
==((D F
ConnectionState((G V
.((V W
	Connected((W `
)((` a
{)) 
if**  "
(**# $
discordSocketClient**$ 7
.**7 8
ShardId**8 ?
>**@ A
$num**B C
)**C D
{++  !
if,,$ &
(,,' (
ShardPresences,,( 6
[,,6 7
discordSocketClient,,7 J
.,,J K
ShardId,,K R
],,R S
==,,T V
presence,,W _
.,,_ `
Length,,` f
-,,f g
$num,,g h
),,h i
ShardPresences--( 6
[--6 7
discordSocketClient--7 J
.--J K
ShardId--K R
]--R S
=--T U
$num--V W
;--W X
else..$ (
ShardPresences//( 6
[//6 7
discordSocketClient//7 J
.//J K
ShardId//K R
]//R S
++//S U
;//U V
await00$ )
discordSocketClient00* =
.00= >"
SetGamewithPlaceholder00> T
(00T U
_discord00U ]
,00] ^
presence00^ f
[00f g
ShardPresences00g u
[00u v 
discordSocketClient	00v â
.
00â ä
ShardId
00ä ë
]
00ë í
]
00í ì
)
00ì î
;
00î ï
}11  !
else22  $
{33  !
if44$ &
(44' (
ShardPresences44( 6
[446 7
$num447 8
]448 9
==44: <
presence44= E
.44E F
Length44F L
-44L M
$num44M N
)44N O
ShardPresences55( 6
[556 7
$num557 8
]558 9
=55: ;
$num55< =
;55= >
else66$ (
ShardPresences77( 6
[776 7
$num777 8
]778 9
++779 ;
;77; <
await88$ )
discordSocketClient88* =
.88= >"
SetGamewithPlaceholder88> T
(88T U
_discord88U ]
,88] ^
presence88^ f
[88f g
ShardPresences88g u
[88u v
$num88v w
]88w x
]88x y
)88y z
;88z {
}99  !
}:: 
};; 
}<< 
}== 
)== 
;== 
}>> 
}?? 	
publicAA 
StartupServiceAA 
(AA 
IServiceProviderBB 
providerBB %
,BB% & 
DiscordShardedClientCC  
discordCC! (
,CC( )
CommandServiceDD 
commandsDD #
,DD# $
IConfigurationRootEE 
configEE %
)EE% &
{FF 	
	_providerGG 
=GG 
providerGG  
;GG  !
_configHH 
=HH 
configHH 
;HH 
_discordII 
=II 
discordII 
;II 
	_commandsJJ 
=JJ 
commandsJJ  
;JJ  !
}KK 	
publicMM 
asyncMM 
TaskMM 

StartAsyncMM $
(MM$ %
)MM% &
{NN 	
stringOO 
discordTokenOO 
=OO  !
_configOO" )
[OO) *
$strOO* :
]OO: ;
;OO; <
ifPP 
(PP 
stringPP 
.PP 
IsNullOrWhiteSpacePP )
(PP) *
discordTokenPP* 6
)PP6 7
)PP7 8
throwQQ 
newQQ #
InvalidProgramExceptionQQ 1
(QQ1 2
$str	QQ2 ü
)
QQü †
;
QQ† °
awaitSS 
_discordSS 
.SS 

LoginAsyncSS %
(SS% &
	TokenTypeSS& /
.SS/ 0
BotSS0 3
,SS3 4
discordTokenSS5 A
)SSA B
;SSB C
awaitTT 
_discordTT 
.TT 

StartAsyncTT %
(TT% &
)TT& '
;TT' (
ShardPresencesUU 
=UU 
newUU  
intUU! $
[UU$ %
_discordUU% -
.UU- .
ShardsUU. 4
.UU4 5
CountUU5 :
]UU: ;
;UU; <
UpdatePresencesVV 
.VV 
StartVV !
(VV! "
)VV" #
;VV# $
awaitWW 
	_commandsWW 
.WW 
AddModulesAsyncWW +
(WW+ ,
AssemblyWW, 4
.WW4 5
GetEntryAssemblyWW5 E
(WWE F
)WWF G
,WWG H
	_providerWWI R
)WWR S
;WWS T
}XX 	
}YY 
publicZZ 

staticZZ 
classZZ )
DiscordShardedClientExtensionZZ 5
{ZZ6 7
public[[ 
static[[ 
Task[[ "
SetGamewithPlaceholder[[ 1
([[1 2
this[[2 6
DiscordSocketClient[[7 J
discordsocket[[K X
,[[X Y 
DiscordShardedClient[[Y m!
discordShardedClient	[[n Ç
,
[[Ç É
string
[[Ñ ä
str
[[ã é
)
[[é è
{
[[ê ë
return\\ 
discordsocket\\  
.\\  !
SetGameAsync\\! -
(\\- .
str\\. 1
.]] 
Replace]] 
(]] 
$str]] '
,]]' ( 
discordShardedClient]]) =
.]]= >
Guilds]]> D
.]]D E
Count]]E J
.]]J K
ToString]]K S
(]]S T
)]]T U
)]]U V
.^^ 
Replace^^ 
(^^ 
$str^^ '
,^^' ( 
discordShardedClient^^) =
.^^= >
Guilds^^> D
.^^D E
Sum^^E H
(^^H I
x^^I J
=>^^K M
x^^N O
.^^O P
Users^^P U
.^^U V
Count^^V [
)^^[ \
.^^\ ]
ToString^^] e
(^^e f
)^^f g
)^^g h
)`` 
;`` 
}aa 	
}bb 
}cc †e
]C:\Users\Matthieu\source\repos\HeroBot-deux-point-z√©ro\HeroBot.Core\Services\VotesService.cs
	namespace 	
HeroBot
 
. 
Core 
. 
Services 
{ 
public 

class 
StateObject 
{ 
public 
Socket 

workSocket  
{! "
get# &
;& '
set( +
;+ ,
}- .
=/ 0
null1 5
;5 6
public 
const 
int 

BufferSize #
=$ %
$num& *
;* +
public 
byte 
[ 
] 
buffer 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
new- 0
byte1 5
[5 6

BufferSize6 @
]@ A
;A B
public 
StringBuilder 
sb 
{  !
get" %
;% &
set' *
;* +
}, -
=. /
new0 3
StringBuilder4 A
(A B
)B C
;C D
} 
public 

class &
AsynchronousSocketListener +
:, -
IVoteService. :
{ 
public 
static 
ManualResetEvent &
allDone' .
{/ 0
get1 4
;4 5
set6 9
;9 :
}; <
== >
new? B
ManualResetEventC S
(S T
falseT Y
)Y Z
;Z [
private 
readonly  
DiscordShardedClient -
_discord. 6
;6 7
public!! 
event!! 
IVoteService!! !
.!!! "
OnVoteHandler!!" /
VoteHandler!!0 ;
;!!; <
public## &
AsynchronousSocketListener## )
(##) * 
DiscordShardedClient##* > 
discordShardedClient##? S
)##S T
{$$ 	
_discord%% 
=%%  
discordShardedClient%% +
;%%+ ,
new&& 
Thread&& 
(&& 
(&& 
)&& 
=>&& 
{&& 
StartListening&& -
(&&- .
)&&. /
;&&/ 0
}&&1 2
)&&2 3
.&&3 4
Start&&4 9
(&&9 :
)&&: ;
;&&; <
Console'' 
.'' 
	WriteLine'' 
('' 
$str'' 8
)''8 9
;''9 :
}(( 	
public** 
void** 
StartListening** "
(**" #
)**# $
{++ 	

IPEndPoint00 
localEndPoint00 $
=00% &
new00' *

IPEndPoint00+ 5
(005 6
	IPAddress006 ?
.00? @
Any00@ C
,00C D
$num00E I
)00I J
;00J K
Socket33 
listener33 
=33 
new33 !
Socket33" (
(33( )
	IPAddress33) 2
.332 3
Any333 6
.336 7
AddressFamily337 D
,33D E

SocketType44 
.44 
Stream44 !
,44! "
ProtocolType44# /
.44/ 0
Tcp440 3
)443 4
;444 5
try77 
{88 
listener99 
.99 
Bind99 
(99 
localEndPoint99 +
)99+ ,
;99, -
listener:: 
.:: 
Listen:: 
(::  
$num::  #
)::# $
;::$ %
while<< 
(<< 
true<< 
)<< 
{== 
allDone?? 
.?? 
Reset?? !
(??! "
)??" #
;??# $
ConsoleBB 
.BB 
	WriteLineBB %
(BB% &
$strBB& C
)BBC D
;BBD E
listenerCC 
.CC 
BeginAcceptCC (
(CC( )
newDD 
AsyncCallbackDD )
(DD) *
AcceptCallbackDD* 8
)DD8 9
,DD9 :
listenerEE  
)EE  !
;EE! "
allDoneHH 
.HH 
WaitOneHH #
(HH# $
)HH$ %
;HH% &
}II 
}KK 
catchLL 
(LL 
	ExceptionLL 
eLL 
)LL 
{MM 
ConsoleNN 
.NN 
	WriteLineNN !
(NN! "
eNN" #
.NN# $
ToStringNN$ ,
(NN, -
)NN- .
)NN. /
;NN/ 0
}OO 
}QQ 	
publicSS 
voidSS 
AcceptCallbackSS "
(SS" #
IAsyncResultSS# /
arSS0 2
)SS2 3
{TT 	
allDoneVV 
.VV 
SetVV 
(VV 
)VV 
;VV 
SocketYY 
listenerYY 
=YY 
(YY 
SocketYY %
)YY% &
arYY& (
.YY( )

AsyncStateYY) 3
;YY3 4
SocketZZ 
handlerZZ 
=ZZ 
listenerZZ %
.ZZ% &
	EndAcceptZZ& /
(ZZ/ 0
arZZ0 2
)ZZ2 3
;ZZ3 4
StateObject]] 
state]] 
=]] 
new]]  #
StateObject]]$ /
(]]/ 0
)]]0 1
;]]1 2
state^^ 
.^^ 

workSocket^^ 
=^^ 
handler^^ &
;^^& '
Send__ 
(__ 
state__ 
.__ 

workSocket__ !
,__! "
$str__# =
)__= >
;__> ?
handler`` 
.`` 
BeginReceive``  
(``  !
state``! &
.``& '
buffer``' -
,``- .
$num``/ 0
,``0 1
StateObject``2 =
.``= >

BufferSize``> H
,``H I
$num``J K
,``K L
newaa 
AsyncCallbackaa !
(aa! "
ReadCallbackaa" .
)aa. /
,aa/ 0
stateaa1 6
)aa6 7
;aa7 8
}bb 	
publicdd 
voiddd 
ReadCallbackdd  
(dd  !
IAsyncResultdd! -
ardd. 0
)dd0 1
{ee 	
Stringff 
contentff 
=ff 
Stringff #
.ff# $
Emptyff$ )
;ff) *
StateObjectjj 
statejj 
=jj 
(jj  !
StateObjectjj! ,
)jj, -
arjj- /
.jj/ 0

AsyncStatejj0 :
;jj: ;
Socketkk 
handlerkk 
=kk 
statekk "
.kk" #

workSocketkk# -
;kk- .
intnn 
	bytesReadnn 
=nn 
handlernn #
.nn# $

EndReceivenn$ .
(nn. /
arnn/ 1
)nn1 2
;nn2 3
ifpp 
(pp 
	bytesReadpp 
>pp 
$numpp 
)pp 
{qq 
statess 
.ss 
sbss 
.ss 
Appendss 
(ss  
Encodingss  (
.ss( )
ASCIIss) .
.ss. /
	GetStringss/ 8
(ss8 9
statett 
.tt 
buffertt  
,tt  !
$numtt" #
,tt# $
	bytesReadtt% .
)tt. /
)tt/ 0
;tt0 1
contentxx 
=xx 
statexx 
.xx  
sbxx  "
.xx" #
ToStringxx# +
(xx+ ,
)xx, -
;xx- .
Consoleyy 
.yy 
	WriteLineyy !
(yy! "
contentyy" )
)yy) *
;yy* +
ifzz 
(zz 
contentzz 
.zz 
EndsWithzz $
(zz$ %
$strzz% ,
)zz, -
)zz- .
{{{ 
Console~~ 
.~~ 
	WriteLine~~ %
(~~% &
String~~& ,
.~~, -
Format~~- 3
(~~3 4
$str~~4 Q
,~~Q R
content 
.  
Length  &
)& '
)' (
;( )
state
ÄÄ 
.
ÄÄ 
sb
ÄÄ 
.
ÄÄ 
Clear
ÄÄ "
(
ÄÄ" #
)
ÄÄ# $
;
ÄÄ$ %
try
ÅÅ 
{
ÇÇ 
var
ÉÉ 
dunamic
ÉÉ #
=
ÉÉ$ %
JsonConvert
ÉÉ& 1
.
ÉÉ1 2
DeserializeObject
ÉÉ2 C
<
ÉÉC D
dynamic
ÉÉD K
>
ÉÉK L
(
ÉÉL M
content
ÉÉM T
.
ÉÉT U
Replace
ÉÉU \
(
ÉÉ\ ]
$str
ÉÉ] d
,
ÉÉd e
String
ÉÉe k
.
ÉÉk l
Empty
ÉÉl q
)
ÉÉq r
)
ÉÉr s
;
ÉÉs t
VoteHandler
ÑÑ #
.
ÑÑ# $
Invoke
ÑÑ$ *
(
ÑÑ* +
new
ÑÑ+ .
DblVote
ÑÑ/ 6
(
ÑÑ6 7
)
ÑÑ7 8
{
ÖÖ 
user
ÜÜ  
=
ÜÜ! "
_discord
ÜÜ# +
.
ÜÜ+ ,
GetUser
ÜÜ, 3
(
ÜÜ3 4
(
ÜÜ4 5
ulong
ÜÜ5 :
)
ÜÜ: ;
dunamic
ÜÜ; B
.
ÜÜB C
userId
ÜÜC I
)
ÜÜI J
,
ÜÜJ K
isPrimed
áá $
=
áá% &
dunamic
áá' .
.
áá. /
isPrimed
áá/ 7
}
àà 
)
àà 
;
àà 
}
ââ 
catch
ää 
(
ää 
	Exception
ää $
exx
ää% (
)
ää( )
{
ää* +
Console
ää, 3
.
ää3 4
	WriteLine
ää4 =
(
ää= >
exx
ää> A
)
ääA B
;
ääB C
}
ääD E
handler
åå 
.
åå 
BeginReceive
åå (
(
åå( )
state
åå) .
.
åå. /
buffer
åå/ 5
,
åå5 6
$num
åå7 8
,
åå8 9
StateObject
åå: E
.
ååE F

BufferSize
ååF P
,
ååP Q
$num
ååR S
,
ååS T
new
çç 
AsyncCallback
çç %
(
çç% &
ReadCallback
çç& 2
)
çç2 3
,
çç3 4
state
çç5 :
)
çç: ;
;
çç; <
}
éé 
else
èè 
{
êê 
handler
íí 
.
íí 
BeginReceive
íí (
(
íí( )
state
íí) .
.
íí. /
buffer
íí/ 5
,
íí5 6
$num
íí7 8
,
íí8 9
StateObject
íí: E
.
ííE F

BufferSize
ííF P
,
ííP Q
$num
ííR S
,
ííS T
new
ìì 
AsyncCallback
ìì %
(
ìì% &
ReadCallback
ìì& 2
)
ìì2 3
,
ìì3 4
state
ìì5 :
)
ìì: ;
;
ìì; <
}
îî 
}
ïï 
}
ññ 	
private
òò 
void
òò 
Send
òò 
(
òò 
Socket
òò  
handler
òò! (
,
òò( )
String
òò* 0
data
òò1 5
)
òò5 6
{
ôô 	
byte
õõ 
[
õõ 
]
õõ 
byteData
õõ 
=
õõ 
Encoding
õõ &
.
õõ& '
ASCII
õõ' ,
.
õõ, -
GetBytes
õõ- 5
(
õõ5 6
data
õõ6 :
)
õõ: ;
;
õõ; <
handler
ûû 
.
ûû 
	BeginSend
ûû 
(
ûû 
byteData
ûû &
,
ûû& '
$num
ûû( )
,
ûû) *
byteData
ûû+ 3
.
ûû3 4
Length
ûû4 :
,
ûû: ;
$num
ûû< =
,
ûû= >
new
üü 
AsyncCallback
üü !
(
üü! "
SendCallback
üü" .
)
üü. /
,
üü/ 0
handler
üü1 8
)
üü8 9
;
üü9 :
}
†† 	
private
¢¢ 
void
¢¢ 
SendCallback
¢¢ !
(
¢¢! "
IAsyncResult
¢¢" .
ar
¢¢/ 1
)
¢¢1 2
{
££ 	
try
§§ 
{
•• 
Socket
ßß 
handler
ßß 
=
ßß  
(
ßß! "
Socket
ßß" (
)
ßß( )
ar
ßß) +
.
ßß+ ,

AsyncState
ßß, 6
;
ßß6 7
int
™™ 
	bytesSent
™™ 
=
™™ 
handler
™™  '
.
™™' (
EndSend
™™( /
(
™™/ 0
ar
™™0 2
)
™™2 3
;
™™3 4
Console
´´ 
.
´´ 
	WriteLine
´´ !
(
´´! "
String
´´" (
.
´´( )
Format
´´) /
(
´´/ 0
$str
´´0 K
,
´´K L
	bytesSent
´´M V
)
´´V W
)
´´W X
;
´´X Y
}
≠≠ 
catch
ÆÆ 
(
ÆÆ 
	Exception
ÆÆ 
e
ÆÆ 
)
ÆÆ 
{
ØØ 
Console
∞∞ 
.
∞∞ 
	WriteLine
∞∞ !
(
∞∞! "
e
∞∞" #
.
∞∞# $
ToString
∞∞$ ,
(
∞∞, -
)
∞∞- .
)
∞∞. /
;
∞∞/ 0
}
±± 
}
≤≤ 	
}
≥≥ 
}¥¥ –4
OC:\Users\Matthieu\source\repos\HeroBot-deux-point-z√©ro\HeroBot.Core\Startup.cs
	namespace 	
	HeroBotv2
 
{ 
public 

class 
Startup 
{ 
public 
IConfigurationRoot !
Configuration" /
{0 1
get2 5
;5 6
}7 8
public 
Startup 
( 
) 
{ 	
var 
builder 
= 
new  
ConfigurationBuilder 2
(2 3
)3 4
. 
SetBasePath 
( 

AppContext '
.' (
BaseDirectory( 5
)5 6
. 
AddYamlFile 
( 
$str *
)* +
;+ ,
Configuration 
= 
builder #
.# $
Build$ )
() *
)* +
;+ ,
} 	
public 
static 
async 
Task  
RunAsync! )
() *
)* +
{ 	
var 
startup 
= 
new 
Startup %
(% &
)& '
;' (
await 
startup 
. 
	_RunAsync #
(# $
)$ %
;% &
}   	
public"" 
async"" 
Task"" 
	_RunAsync"" #
(""# $
)""$ %
{## 	
var%% 
services%% 
=%% 
new%% 
ServiceCollection%% 0
(%%0 1
)%%1 2
;%%2 3
ConfigureServices&& 
(&& 
services&& &
)&&& '
;&&' (
var'' 
provider'' 
='' 
services'' #
.''# $ 
BuildServiceProvider''$ 8
(''8 9
)''9 :
;'': ;
provider(( 
.(( 
GetRequiredService(( '
<((' (
LoggingService((( 6
>((6 7
(((7 8
)((8 9
;((9 :
provider)) 
.)) 
GetRequiredService)) '
<))' (
IDatabaseService))( 8
>))8 9
())9 :
))): ;
;)); <
provider** 
.** 
GetRequiredService** '
<**' (
IRedisService**( 5
>**5 6
(**6 7
)**7 8
;**8 9
provider++ 
.++ 
GetRequiredService++ '
<++' (
ICooldownService++( 8
>++8 9
(++9 :
)++: ;
;++; <
provider,, 
.,, 
GetRequiredService,, '
<,,' (
CooldownService,,( 7
>,,7 8
(,,8 9
),,9 :
;,,: ;
provider-- 
.-- 0
$GetAllServicesFromExternalAssemblies-- 9
(--9 :
)--: ;
;--; <
provider.. 
... 
GetRequiredService.. '
<..' (
CommandHandler..( 6
>..6 7
(..7 8
)..8 9
;..9 :
provider// 
.// 
GetRequiredService// '
<//' (
IVoteService//( 4
>//4 5
(//5 6
)//6 7
;//7 8
await00 
provider00 
.00 
GetRequiredService00 -
<00- .
StartupService00. <
>00< =
(00= >
)00> ?
.11 

StartAsync11 
(11 
)11 
;11 
await22 
provider22 
.22 
GetRequiredService22 -
<22- .
ModulesService22. <
>22< =
(22= >
)22> ?
.33 *
LoadModulesFromAssembliesAsync33 /
(33/ 0
)330 1
;331 2
await44 
Task44 
.44 
Delay44 
(44 
-44 
$num44 
)44  
;44  !
}55 	
internal77 
void77 
ConfigureServices77 '
(77' (
IServiceCollection77( :
services77; C
)77C D
{88 	
services99 
.99 
AddSingleton99 !
(99! "
new99" % 
DiscordShardedClient99& :
(99: ;
new99; >
DiscordSocketConfig99? R
{:: 
LogLevel;; 
=;; 
LogSeverity;; &
.;;& '
Info;;' +
,;;+ ,
MessageCacheSize<<  
=<<! "
$num<<# $
}>> 
)>> 
)>> 
.?? 
AddSingleton?? 
(?? 
new?? 
CommandService?? ,
(??, -
new??- 0 
CommandServiceConfig??1 E
{@@ 
LogLevelAA 
=AA 
LogSeverityAA &
.AA& '
InfoAA' +
,AA+ ,
DefaultRunModeBB 
=BB  
RunModeBB! (
.BB( )
AsyncBB) .
,BB. /
}CC 
)CC 
)CC 
.FF 
AddSingletonFF 
<FF 
IDatabaseServiceFF *
,FF* +
HeroBotContextFF, :
>FF: ;
(FF; <
)FF< =
.GG 
AddSingletonGG 
<GG 
IRedisServiceGG '
,GG' (
RedisServiceGG) 5
>GG5 6
(GG6 7
)GG7 8
.HH 
AddSingletonHH 
<HH 
ICooldownServiceHH *
,HH* +
CooldownServiceHH, ;
>HH; <
(HH< =
)HH= >
.II 
AddSingletonII 
<II 
CooldownServiceII )
>II) *
(II* +
)II+ ,
.JJ 
AddSingletonJJ 
<JJ 
CommandHandlerJJ (
>JJ( )
(JJ) *
)JJ* +
.KK 
AddSingletonKK 
<KK 
StartupServiceKK (
>KK( )
(KK) *
)KK* +
.LL 
AddSingletonLL 
<LL 
LoggingServiceLL (
>LL( )
(LL) *
)LL* +
.MM 
AddSingletonMM 
<MM 
ModulesServiceMM (
>MM( )
(MM) *
)MM* +
.NN 
AddSingletonNN 
<NN 
RandomNN  
>NN  !
(NN! "
)NN" #
.OO 
AddSingletonOO 
<OO 
IVoteServiceOO &
,OO& '&
AsynchronousSocketListenerOO( B
>OOB C
(OOC D
)OOD E
.PP 
AddSingletonPP 
(PP 
ConfigurationPP '
)PP' (
.QQ 1
%LoadAllServicesFromExternalAssembilesQQ 2
(QQ2 3
)QQ3 4
;QQ4 5
}RR 	
}SS 
}TT 