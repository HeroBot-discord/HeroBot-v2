ﬁ
lC:\Users\Matthieu\source\repos\HeroBot-deux-point-z√©ro\HeroBot.Plugins.RemindMe\Migrations\1807201925589.cs
	namespace 	
HeroBot
 
. 
Plugins 
. 
RemindMe "
." #

Migrations# -
{ 
[ 
	Migration 
( 
$num 
) 
] 
public		 

class		 
_1807201925589		 
:		  !
	Migration		" +
{

 
public 
override 
void 
Down !
(! "
)" #
{ 	
Delete 
. 
Table 
( 
$str $
)$ %
;% &
} 	
public 
override 
void 
Up 
(  
)  !
{ 	
Create 
. 
Table 
( 
$str $
)$ %
. 

WithColumn 
( 
$str  
)  !
.! "
AsInt64" )
() *
)* +
.+ ,

PrimaryKey, 6
(6 7
)7 8
.8 9
Identity9 A
(A B
)B C
. 

WithColumn 
( 
$str $
)$ %
.% &
AsInt64& -
(- .
). /
. 

WithColumn 
( 
$str $
)$ %
.% &
AsString& .
(. /
)/ 0
;0 1
} 	
} 
} ¶&
jC:\Users\Matthieu\source\repos\HeroBot-deux-point-z√©ro\HeroBot.Plugins.RemindMe\Modules\RemindMeModule.cs
	namespace 	
HeroBot
 
. 
Plugins 
. 
RemindMe "
." #
Modules# *
{ 
[ 

NeedPlugin 
( 
) 
] 
[ 
Name 	
(	 

$str
 
) 
] 
public 

class 
RemindMeModule 
:  !

ModuleBase" ,
<, - 
SocketCommandContext- A
>A B
{ 
private 
readonly 
ReminderService (

_remainder) 3
;3 4
public 
RemindMeModule 
( 
ReminderService -
remainderService. >
)> ?
{@ A

_remainder 
= 
remainderService )
;) *
} 	
[ 	
Cooldown	 
( 
$num 
) 
] 
[ 	
Command	 
( 
$str 
) 
, 
Alias "
(" #
$str# +
)+ ,
], -
public 
async 
Task 
CreateReminder (
(( )
TimeSpan) 1
time2 6
,6 7
[7 8
	Remainder8 A
]A B
stringB H
toRemindI Q
)Q R
{S T
if 
( 
await 

_remainder 
.  
CreateReminder  .
(. /
new/ 2
Reminder3 ;
(; <
)< =
{ 
remind 
= 
toRemind !
,! "
TimeSpan 
= 
time 
,  
userId 
= 
Context  
.  !
User! %
.% &
Id& (
} 
) 
) 
await   

ReplyAsync    
(    !
$"  ! #4
(:white_check_mark: I will remind you in   # K
{  K L
time  L P
.  P Q
ToHumanReadable  Q `
(  ` a
)  a b
}  b c
s  c d
"  d e
)  e f
;  f g
else!! 
await"" 

ReplyAsync""  
(""  !
$str""! @
)""@ A
;""A B
}## 	
[$$ 	
Cooldown$$	 
($$ 
$num$$ 
)$$ 
]$$ 
[%% 	
Command%%	 
(%% 
$str%% 
)%% 
,%%  
Alias%%! &
(%%& '
$str%%' +
)%%+ ,
]%%, -
public&& 
async&& 
Task&& 
MyReminders&& %
(&&% &
)&&& '
{&&( )
var'' 
	reminders'' 
='' 
await'' !

_remainder''" ,
.'', -
GetReminders''- 9
(''9 :
Context'': A
.''A B
User''B F
.''F G
Id''G I
)''I J
;''J K
var(( 
embed(( 
=(( 
new(( 
EmbedBuilder(( (
(((( )
)(() *
.)) 
WithRandomColor))  
())  !
)))! "
.** 
WithCopyrightFooter** $
(**$ %
Context**% ,
.**, -
User**- 1
.**1 2
Username**2 :
,**: ;
$str**< I
)**I J
.++ 
	WithTitle++ 
(++ 
$str++ :
)++: ;
;++; <
foreach,, 
(,, 
dynamic,, 
d,, 
in,, !
	reminders,," +
.,,+ ,
Where,,, 1
(,,1 2
x,,2 3
=>,,4 6
!,,7 8
x,,8 9
.,,9 :
anulated,,: B
),,B C
),,C D
{,,E F
embed-- 
.-- 
AddField-- 
(-- 
$"-- !
**`--! $
{--$ %
d--% &
.--& '
x--' (
.--( )
reason--) /
}--/ 0
`**--0 3
"--3 4
,--4 5
$"--6 8
*--8 9
{--9 :
(--: ;
(--; <
TimeSpan--< D
)--D E
d--E F
.--F G
r--G H
)--H I
.--I J
ToHumanReadable--J Y
(--Y Z
)--Z [
}--[ \
 remaining*--\ g
"--g h
,--h i
true--j n
)--n o
;--o p
}.. 
await// 

ReplyAsync// 
(// 
embed// "
://" #
embed//$ )
.//) *
Build//* /
(/// 0
)//0 1
)//1 2
;//2 3
}00 	
}11 
}22 ˝
bC:\Users\Matthieu\source\repos\HeroBot-deux-point-z√©ro\HeroBot.Plugins.RemindMe\PluginRefferal.cs
	namespace 	
HeroBot
 
. 
Plugins 
. 
HeroBot !
{ 
public 

class 
PluginRefferal 
:  !
IPluginRefferal" 1
{		 
}

 
} êe
lC:\Users\Matthieu\source\repos\HeroBot-deux-point-z√©ro\HeroBot.Plugins.RemindMe\Services\ReminderService.cs
	namespace 	
HeroBot
 
. 
Plugins 
. 
RemindMe "
." #
Services# +
{ 
[ 
Service 
] 
public 

class 
ReminderService  
{ 
private 
readonly 
IRedisService &
_redis' -
;- .
private 
readonly  
DiscordShardedClient -
_discord. 6
;6 7
private 
readonly 
IDatabaseService )
	_database* 3
;3 4
private 
readonly 
string 
GetReminderById  /
=0 1
$str2 `
;` a
private 
readonly 
string 
GetReminderPerUser  2
=3 4
$str5 g
;g h
private 
readonly 
string 
DeleteReminderbyId  2
=3 4
$str5 a
;a b
private 
readonly 
string !
CountRemindersPerUser  5
=6 7
$str8 q
;q r
private 
readonly 
string 
InsertReminder  .
=/ 0
$str	1 é
;
é è
public 
ReminderService 
( 
IRedisService ,
redisService- 9
,9 :
IConfigurationRoot; M
oN O
,O P
IDatabaseServiceQ a
databaseServiceb q
,q r!
DiscordShardedClient	s á!
discordSocketClient
à õ
)
õ ú
{ 	
_redis 
= 
redisService !
;! "
_discord   
=   
discordSocketClient   *
;  * +
	_database!! 
=!! 
databaseService!! '
;!!' (
_redis"" 
."" 
GetSubscriber""  
(""  !
)""! "
.""" #
SubscribeAsync""# 1
(""1 2
$"""2 4
__keyevent@""4 ?
{""? @
o""@ A
.""A B

GetSection""B L
(""L M
$str""M T
)""T U
[""U V
$str""V `
]""` a
}""a b

__:expired""b l
"""l m
,""m n
OnKeyRemove""o z
)""z {
.""{ |
Wait	""| Ä
(
""Ä Å
)
""Å Ç
;
""Ç É
}## 	
private%% 
void%% 
OnKeyRemove%%  
(%%  !
RedisChannel%%! -
arg1%%. 2
,%%2 3

RedisValue%%4 >
arg2%%? C
)%%C D
{&& 	
try'' 
{(( 
Console)) 
.)) 
	WriteLine)) !
())! "
arg2))" &
.))& '
ToString))' /
())/ 0
)))0 1
)))1 2
;))2 3
var** 
name** 
=** 
arg2** 
.**  
ToString**  (
(**( )
)**) *
.*** +
Split**+ 0
(**0 1
$char**1 4
)**4 5
;**5 6
Console++ 
.++ 
	WriteLine++ !
(++! "
name++" &
.++& '
Length++' -
)++- .
;++. /
if,, 
(,, 
name,, 
.,, 
Length,, 
==,,  "
$num,,# $
&&,,% '
name,,( ,
[,,, -
$num,,- .
],,. /
==,,0 2
$str,,3 =
&&,,> @
name,,A E
[,,E F
$num,,F G
],,G H
==,,I K
$str,,L T
),,T U
{-- 
var.. 

reminderId.. "
=..# $
name..% )
[..) *
$num..* +
]..+ ,
;.., -
using// 
(// 
var// 
conn// #
=//$ %
(//& '
NpgsqlConnection//' 7
)//7 8
	_database//8 A
.//A B
GetDbConnection//B Q
(//Q R
)//R S
)//S T
{00 
conn11 
.11 
Open11 !
(11! "
)11" #
;11# $
conn22 
.22 

QueryAsync22 '
(22' (
GetReminderById22( 7
,227 8
new229 <
{22= >
id22? A
=22B C

reminderId22D N
}22O P
)22P Q
.22Q R
ContinueWith22R ^
(22^ _
(22_ `
x22` a
)22a b
=>22c e
{33 
var44 !
cont44" &
=44' (
x44) *
.44* +
Result44+ 1
.441 2
FirstOrDefault442 @
(44@ A
)44A B
;44B C
if55  
(55! "
cont55" &
!=55' )
null55* .
)55. /
{66 
var77" %
userId77& ,
=77- .
(77/ 0
ulong770 5
)775 6
cont776 :
.77: ;
userId77; A
;77A B
var88" %
reason88& ,
=88- .
(88/ 0
string880 6
)886 7
cont887 ;
.88; <
reason88< B
;88B C
_discord99" *
.99* +
GetUser99+ 2
(992 3
userId993 9
)999 :
.99: ;%
GetOrCreateDMChannelAsync99; T
(99T U
)99U V
.99V W
ContinueWith99W c
(99c d
(99d e
x99e f
)99f g
=>99h j
{::" #
var;;& )
dm;;* ,
=;;- .
x;;/ 0
.;;0 1
Result;;1 7
;;;7 8
dm<<& (
.<<( )
SendMessageAsync<<) 9
(<<9 :
$"<<: <'
Hay :watch: ! It's time to <<< W
{<<W X
reason<<X ^
}<<^ _
"<<_ `
)<<` a
.<<a b
ContinueWith<<b n
(<<n o
(<<o p
v<<p q
)<<q r
=><<s u
{==& '
conn>>* .
.>>. /
Execute>>/ 6
(>>6 7
new>>7 :
CommandDefinition>>; L
(>>L M
DeleteReminderbyId>>M _
,>>_ `
new>>a d
{>>e f
id>>g i
=>>j k

reminderId>>l v
}>>w x
)>>x y
)>>y z
;>>z {
}??& '
)??' (
;??( )
}@@" #
)@@# $
;@@$ %
}AA 
}BB 
)BB 
;BB 
}DD 
}EE 
}FF 
catchGG 
(GG 
	ExceptionGG 
eGG 
)GG 
{GG  !
ConsoleGG" )
.GG) *
	WriteLineGG* 3
(GG3 4
eGG4 5
)GG5 6
;GG6 7
}GG8 9
}HH 	
internalJJ 
asyncJJ 
TaskJJ 
<JJ 
IEnumerableJJ '
<JJ' (
dynamicJJ( /
>JJ/ 0
>JJ0 1
GetRemindersJJ2 >
(JJ> ?
ulongJJ? D
idJJE G
)JJG H
{KK 	
usingLL 
(LL 
varLL 
connLL 
=LL 
(LL 
NpgsqlConnectionLL /
)LL/ 0
	_databaseLL0 9
.LL9 :
GetDbConnectionLL: I
(LLI J
)LLJ K
)LLK L
{MM 
varNN 
resultNN 
=NN 
awaitNN "
connNN# '
.NN' (

QueryAsyncNN( 2
(NN2 3
GetReminderPerUserNN3 E
,NNE F
newNNG J
{NNK L
idNNM O
=NNP Q
(NNR S
longNNS W
)NNW X
idNNX Z
}NN[ \
)NN\ ]
;NN] ^
returnOO 
resultOO 
.OO 
SelectOO $
(OO$ %
asyncOO% *
(OO+ ,
xOO, -
)OO- .
=>OO/ 1
{PP 
varQQ 
vQQ 
=QQ 
(QQ 
awaitQQ "
_redisQQ# )
.QQ) *
GetDatabaseQQ* 5
(QQ5 6
)QQ6 7
.QQ7 8$
StringGetWithExpiryAsyncQQ8 P
(QQP Q
$"QQQ S
reminder:remove:QQS c
{QQc d
xQQd e
.QQe f
IdQQf h
}QQh i
"QQi j
)QQj k
)QQk l
.QQl m
ExpiryQQm s
;QQs t
returnSS 
newSS 
{TT 
xUU 
,UU 
rVV 
=VV 
vVV 
}WW 
;WW 
}XX 
)XX 
.XX 
SelectXX 
(XX 
(XX 
xXX 
)XX 
=>XX  
{XX! "
xXX# $
.XX$ %
WaitXX% )
(XX) *
)XX* +
;XX+ ,
returnXX- 3
xXX4 5
.XX5 6
ResultXX6 <
;XX< =
}XX> ?
)XX? @
.XX@ A
SelectXXA G
(XXG H
xXXH I
=>XXJ L
{YY 
ifZZ 
(ZZ 
!ZZ 
xZZ 
.ZZ 
rZZ 
.ZZ 
HasValueZZ %
)ZZ% &
{[[ 
return\\ 
new\\ "
{]] 
x^^ 
.^^ 
x^^ 
,^^  
r__ 
=__ 
x__  !
.__! "
r__" #
,__# $
anulated`` $
=``% &
true``' +
}aa 
;aa 
}bb 
returncc 
newcc 
{dd 
xee 
.ee 
xee 
,ee 
rff 
=ff 
xff 
.ff 
rff 
,ff  
anulatedgg  
=gg! "
falsegg# (
}hh 
;hh 
}ii 
)ii 
;ii 
}jj 
}kk 	
publicmm 
asyncmm 
Taskmm 
<mm 
boolmm 
>mm 
CreateRemindermm  .
(mm. /
Remindermm/ 7
remindermm8 @
)mm@ A
{nn 	
usingpp 
(pp 
varpp 
connpp 
=pp 
(pp 
NpgsqlConnectionpp /
)pp/ 0
	_databasepp0 9
.pp9 :
GetDbConnectionpp: I
(ppI J
)ppJ K
)ppK L
{qq 
connrr 
.rr 
Openrr 
(rr 
)rr 
;rr 
varss 
contss 
=ss 
connss 
.ss  
Queryss  %
(ss% &!
CountRemindersPerUserss& ;
,ss; <
newss= @
{ssA B
idssC E
=ssF G
(ssH I
longssI M
)ssM N
reminderssN V
.ssV W
userIdssW ]
}ss^ _
)ss_ `
.ss` a
Firstssa f
(ssf g
)ssg h
.ssh i
countssi n
;ssn o
iftt 
(tt 
conttt 
<tt 
$numtt 
)tt 
{uu 
varvv 
idvv 
=vv 
connvv !
.vv! "
Queryvv" '
(vv' (
InsertRemindervv( 6
,vv6 7
newvv8 ;
{vv< =
userIdvv> D
=vvE F
(vvG H
longvvH L
)vvL M
remindervvM U
.vvU V
userIdvvV \
,vv\ ]
reasonvv^ d
=vve f
remindervvg o
.vvo p
remindvvp v
}vvw x
)vvx y
.vvy z
Firstvvz 
(	vv Ä
)
vvÄ Å
.
vvÅ Ç
Id
vvÇ Ñ
;
vvÑ Ö
awaitww 
_redisww  
.ww  !
GetDatabaseww! ,
(ww, -
)ww- .
.ww. /
StringSetAsyncww/ =
(ww= >
$"ww> @
reminder:remove:ww@ P
{wwP Q
idwwQ S
}wwS T
"wwT U
,wwU V
StringwwW ]
.ww] ^
Emptyww^ c
,wwc d
reminderwwe m
.wwm n
TimeSpanwwn v
)wwv w
;www x
returnxx 
truexx 
;xx  
}yy 
elsezz 
{{{ 
return|| 
false||  
;||  !
}}} 
}~~ 
} 	
}
ÄÄ 
public
ÅÅ 

class
ÅÅ 
Reminder
ÅÅ 
{
ÇÇ 
public
ÉÉ 
ulong
ÉÉ 
userId
ÉÉ 
{
ÉÉ 
get
ÉÉ !
;
ÉÉ! "
set
ÉÉ# &
;
ÉÉ& '
}
ÉÉ( )
public
ÑÑ 
string
ÑÑ 
remind
ÑÑ 
{
ÑÑ 
get
ÑÑ "
;
ÑÑ" #
set
ÑÑ$ '
;
ÑÑ' (
}
ÑÑ) *
public
ÖÖ 
TimeSpan
ÖÖ 
TimeSpan
ÖÖ  
{
ÖÖ! "
get
ÖÖ# &
;
ÖÖ& '
set
ÖÖ( +
;
ÖÖ+ ,
}
ÖÖ- .
}
ÜÜ 
}áá 