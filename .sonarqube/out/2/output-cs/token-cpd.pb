ﬁ
lC:\Users\Matthieu\source\repos\HeroBot-deux-point-z√©ro\HeroBot.Plugins.RemindMe\Migrations\1807201925589.cs
	namespace 	
HeroBot
 
. 
Plugins 
. 
RemindMe "
." #

Migrations# -
{ 
[ 
	Migration 
( 
$num 
) 
] 
public 

class 
_1807201925589 
:  !
	Migration" +
{ 
public 
override 
void 
Down !
(! "
)" #
{		 	
Delete

 
.

 
Table

 
(

 
$str

 $
)

$ %
;

% &
} 	
public 
override 
void 
Up 
(  
)  !
{ 	
Create 
. 
Table 
( 
$str $
)$ %
. 

WithColumn 
( 
$str  
)  !
.! "
AsInt64" )
() *
)* +
.+ ,

PrimaryKey, 6
(6 7
)7 8
.8 9
Identity9 A
(A B
)B C
. 

WithColumn 
( 
$str $
)$ %
.% &
AsInt64& -
(- .
). /
. 

WithColumn 
( 
$str $
)$ %
.% &
AsString& .
(. /
)/ 0
;0 1
} 	
} 
} ß&
jC:\Users\Matthieu\source\repos\HeroBot-deux-point-z√©ro\HeroBot.Plugins.RemindMe\Modules\RemindMeModule.cs
	namespace

 	
HeroBot


 
.

 
Plugins

 
.

 
RemindMe

 "
.

" #
Modules

# *
{ 
[ 

NeedPlugin 
( 
) 
] 
[ 
Name 	
(	 

$str
 
) 
] 
public 

class 
RemindMeModule 
:  !

ModuleBase" ,
<, - 
SocketCommandContext- A
>A B
{ 
private 
readonly 
ReminderService (

_remainder) 3
;3 4
public 
RemindMeModule 
( 
ReminderService -
remainderService. >
)> ?
{@ A

_remainder 
= 
remainderService )
;) *
} 	
[ 	
Cooldown	 
( 
$num 
) 
] 
[ 	
Command	 
( 
$str 
) 
, 
Alias "
(" #
$str# +
)+ ,
], -
public 
async 
Task 
CreateReminder (
(( )
TimeSpan) 1
time2 6
,6 7
[7 8
	Remainder8 A
]A B
stringB H
toRemindI Q
)Q R
{S T
if 
( 
await 

_remainder 
.  
CreateReminder  .
(. /
new/ 2
Reminder3 ;
(; <
)< =
{ 
Remind 
= 
toRemind !
,! "
TimeSpan 
= 
time 
,  
UserId 
= 
Context  
.  !
User! %
.% &
Id& (
} 
) 
) 
await 

ReplyAsync  
(  !
$"! #5
):white_check_mark: I will remind you in `# L
{L M
timeM Q
.Q R
ToHumanReadableR a
(a b
)b c
}c d
`d e
"e f
)f g
;g h
else   
await!! 

ReplyAsync!!  
(!!  !
$str!!! @
)!!@ A
;!!A B
}"" 	
[## 	
Cooldown##	 
(## 
$num## 
)## 
]## 
[$$ 	
Command$$	 
($$ 
$str$$ 
)$$ 
,$$  
Alias$$! &
($$& '
$str$$' +
)$$+ ,
]$$, -
public%% 
async%% 
Task%% 
MyReminders%% %
(%%% &
)%%& '
{%%( )
var&& 
	reminders&& 
=&& 
await&& !

_remainder&&" ,
.&&, -
GetReminders&&- 9
(&&9 :
Context&&: A
.&&A B
User&&B F
.&&F G
Id&&G I
)&&I J
;&&J K
var'' 
embed'' 
='' 
new'' 
EmbedBuilder'' (
(''( )
)'') *
.(( 
WithRandomColor((  
(((  !
)((! "
.)) 
WithCopyrightFooter)) $
())$ %
Context))% ,
.)), -
User))- 1
.))1 2
Username))2 :
,)): ;
$str))< I
)))I J
.** 
	WithTitle** 
(** 
$str** :
)**: ;
;**; <
foreach++ 
(++ 
dynamic++ 
d++ 
in++ !
	reminders++" +
.+++ ,
Where++, 1
(++1 2
x++2 3
=>++4 6
!++7 8
x++8 9
.++9 :
anulated++: B
)++B C
)++C D
{++E F
embed,, 
.,, 
AddField,, 
(,, 
$",, !
**`,,! $
{,,$ %
d,,% &
.,,& '
x,,' (
.,,( )
reason,,) /
},,/ 0
`**,,0 3
",,3 4
,,,4 5
$",,6 8
*,,8 9
{,,9 :
(,,: ;
(,,; <
TimeSpan,,< D
),,D E
d,,E F
.,,F G
r,,G H
),,H I
.,,I J
ToHumanReadable,,J Y
(,,Y Z
),,Z [
},,[ \
 remaining*,,\ g
",,g h
,,,h i
true,,j n
),,n o
;,,o p
}-- 
await.. 

ReplyAsync.. 
(.. 
embed.. "
:.." #
embed..$ )
...) *
Build..* /
(../ 0
)..0 1
)..1 2
;..2 3
}// 	
}00 
}11 ˝
bC:\Users\Matthieu\source\repos\HeroBot-deux-point-z√©ro\HeroBot.Plugins.RemindMe\PluginRefferal.cs
	namespace 	
HeroBot
 
. 
Plugins 
. 
HeroBot !
{ 
public 

class 
PluginRefferal 
:  !
IPluginRefferal" 1
{ 
} 
} Êb
lC:\Users\Matthieu\source\repos\HeroBot-deux-point-z√©ro\HeroBot.Plugins.RemindMe\Services\ReminderService.cs
	namespace 	
HeroBot
 
. 
Plugins 
. 
RemindMe "
." #
Services# +
{ 
[ 
Service 
] 
public 

class 
ReminderService  
{ 
private 
readonly 
IRedisService &
_redis' -
;- .
private 
readonly  
DiscordShardedClient -
_discord. 6
;6 7
private 
readonly 
IDatabaseService )
	_database* 3
;3 4
private 
readonly 
string 
GetReminderById  /
=0 1
$str2 `
;` a
private 
readonly 
string 
GetReminderPerUser  2
=3 4
$str5 g
;g h
private 
readonly 
string 
DeleteReminderbyId  2
=3 4
$str5 a
;a b
private 
readonly 
string !
CountRemindersPerUser  5
=6 7
$str8 q
;q r
private 
readonly 
string 
InsertReminder  .
=/ 0
$str	1 é
;
é è
public 
ReminderService 
( 
IRedisService ,
redisService- 9
,9 :
IConfigurationRoot; M
oN O
,O P
IDatabaseServiceQ a
databaseServiceb q
,q r!
DiscordShardedClient	s á!
discordSocketClient
à õ
)
õ ú
{ 	
_redis 
= 
redisService !
;! "
_discord   
=   
discordSocketClient   *
;  * +
	_database!! 
=!! 
databaseService!! '
;!!' (
_redis"" 
."" 
GetSubscriber""  
(""  !
)""! "
.""" #
SubscribeAsync""# 1
(""1 2
$"""2 4
__keyevent@""4 ?
{""? @
o""@ A
.""A B

GetSection""B L
(""L M
$str""M T
)""T U
[""U V
$str""V `
]""` a
}""a b

__:expired""b l
"""l m
,""m n
OnKeyRemove""o z
)""z {
.""{ |
Wait	""| Ä
(
""Ä Å
)
""Å Ç
;
""Ç É
}## 	
private%% 
void%% 
OnKeyRemove%%  
(%%  !
RedisChannel%%! -
arg1%%. 2
,%%2 3

RedisValue%%4 >
arg2%%? C
)%%C D
{&& 	
try'' 
{(( 
Console)) 
.)) 
	WriteLine)) !
())! "
arg2))" &
.))& '
ToString))' /
())/ 0
)))0 1
)))1 2
;))2 3
var** 
name** 
=** 
arg2** 
.**  
ToString**  (
(**( )
)**) *
.*** +
Split**+ 0
(**0 1
$char**1 4
)**4 5
;**5 6
Console++ 
.++ 
	WriteLine++ !
(++! "
name++" &
.++& '
Length++' -
)++- .
;++. /
if,, 
(,, 
name,, 
.,, 
Length,, 
==,,  "
$num,,# $
&&,,% '
name,,( ,
[,,, -
$num,,- .
],,. /
==,,0 2
$str,,3 =
&&,,> @
name,,A E
[,,E F
$num,,F G
],,G H
==,,I K
$str,,L T
),,T U
{-- 
var.. 

reminderId.. "
=..# $
long..% )
...) *
Parse..* /
(../ 0
name..0 4
[..4 5
$num..5 6
]..6 7
)..7 8
;..8 9
using// 
var// 
conn// "
=//# $
(//% &
NpgsqlConnection//& 6
)//6 7
	_database//7 @
.//@ A
GetDbConnection//A P
(//P Q
)//Q R
;//R S
conn00 
.00 

QueryAsync00 #
(00# $
GetReminderById00$ 3
,003 4
new005 8
{009 :
id00; =
=00> ?

reminderId00@ J
}00K L
)00L M
.00M N
ContinueWith00N Z
(00Z [
(00[ \
x00\ ]
)00] ^
=>00_ a
{11 
var22 
cont22 "
=22# $
x22% &
.22& '
Result22' -
.22- .
FirstOrDefault22. <
(22< =
)22= >
;22> ?
if33 
(33 
cont33 "
!=33# %
null33& *
)33* +
{44 
var55 !
userId55" (
=55) *
(55+ ,
ulong55, 1
)551 2
cont552 6
.556 7
userId557 =
;55= >
var66 !
reason66" (
=66) *
(66+ ,
string66, 2
)662 3
cont663 7
.667 8
reason668 >
;66> ?
_discord77 &
.77& '
GetUser77' .
(77. /
userId77/ 5
)775 6
.776 7%
GetOrCreateDMChannelAsync777 P
(77P Q
)77Q R
.77R S
ContinueWith77S _
(77_ `
(77` a
x77a b
)77b c
=>77d f
{88 
var99" %
dm99& (
=99) *
x99+ ,
.99, -
Result99- 3
;993 4
dm::" $
.::$ %
SendMessageAsync::% 5
(::5 6
$"::6 8'
Hay :watch: ! It's time to ::8 S
{::S T
reason::T Z
}::Z [
"::[ \
)::\ ]
.::] ^
ContinueWith::^ j
(::j k
(::k l
v::l m
)::m n
=>::o q
{;;" #
conn<<& *
.<<* +
Execute<<+ 2
(<<2 3
DeleteReminderbyId<<3 E
,<<E F
new<<G J
{<<K L
id<<M O
=<<P Q

reminderId<<R \
}<<] ^
)<<^ _
;<<_ `
}==" #
)==# $
;==$ %
}>> 
)>>  
;>>  !
}?? 
}@@ 
)@@ 
.@@ 
Wait@@ 
(@@ 
)@@ 
;@@  
}AA 
}BB 
catchCC 
(CC 
	ExceptionCC 
eCC 
)CC 
{CC  !
ConsoleCC" )
.CC) *
	WriteLineCC* 3
(CC3 4
eCC4 5
)CC5 6
;CC6 7
}CC8 9
}DD 	
internalFF 
asyncFF 
TaskFF 
<FF 
IEnumerableFF '
<FF' (
dynamicFF( /
>FF/ 0
>FF0 1
GetRemindersFF2 >
(FF> ?
ulongFF? D
idFFE G
)FFG H
{GG 	
usingHH 
varHH 
connHH 
=HH 
(HH 
NpgsqlConnectionHH .
)HH. /
	_databaseHH/ 8
.HH8 9
GetDbConnectionHH9 H
(HHH I
)HHI J
;HHJ K
varII 
resultII 
=II 
awaitII 
connII #
.II# $

QueryAsyncII$ .
(II. /
GetReminderPerUserII/ A
,IIA B
newIIC F
{IIG H
idIII K
=IIL M
(IIN O
longIIO S
)IIS T
idIIT V
}IIW X
)IIX Y
;IIY Z
returnJJ 
resultJJ 
.JJ 
SelectJJ  
(JJ  !
asyncJJ! &
(JJ' (
xJJ( )
)JJ) *
=>JJ+ -
{KK 
varLL 
vLL 
=LL 
(LL 
awaitLL 
_redisLL %
.LL% &
GetDatabaseLL& 1
(LL1 2
)LL2 3
.LL3 4$
StringGetWithExpiryAsyncLL4 L
(LLL M
$"LLM O
reminder:remove:LLO _
{LL_ `
xLL` a
.LLa b
IdLLb d
}LLd e
"LLe f
)LLf g
)LLg h
.LLh i
ExpiryLLi o
;LLo p
returnNN 
newNN 
{OO 
xPP 
,PP 
rQQ 
=QQ 
vQQ 
}RR 
;RR 
}SS 
)SS 
.SS 
SelectSS 
(SS 
(SS 
xSS 
)SS 
=>SS 
{SS 
xSS  
.SS  !
WaitSS! %
(SS% &
)SS& '
;SS' (
returnSS) /
xSS0 1
.SS1 2
ResultSS2 8
;SS8 9
}SS: ;
)SS; <
.SS< =
SelectSS= C
(SSC D
xSSD E
=>SSF H
{TT 
ifUU 
(UU 
!UU 
xUU 
.UU 
rUU 
.UU 
HasValueUU !
)UU! "
{VV 
returnWW 
newWW 
{XX 
xYY 
.YY 
xYY 
,YY 
xZZ 
.ZZ 
rZZ 
,ZZ 
anulated[[  
=[[! "
true[[# '
}\\ 
;\\ 
}]] 
return^^ 
new^^ 
{__ 
x`` 
.`` 
x`` 
,`` 
xaa 
.aa 
raa 
,aa 
anulatedbb 
=bb 
falsebb $
}cc 
;cc 
}dd 
)dd 
;dd 
}ee 	
publicgg 
asyncgg 
Taskgg 
<gg 
boolgg 
>gg 
CreateRemindergg  .
(gg. /
Remindergg/ 7
remindergg8 @
)gg@ A
{hh 	
usingjj 
varjj 
connjj 
=jj 
(jj 
NpgsqlConnectionjj .
)jj. /
	_databasejj/ 8
.jj8 9
GetDbConnectionjj9 H
(jjH I
)jjI J
;jjJ K
connkk 
.kk 
Openkk 
(kk 
)kk 
;kk 
varll 
contll 
=ll 
connll 
.ll 
Queryll !
(ll! "!
CountRemindersPerUserll" 7
,ll7 8
newll9 <
{ll= >
idll? A
=llB C
(llD E
longllE I
)llI J
reminderllJ R
.llR S
UserIdllS Y
}llZ [
)ll[ \
.ll\ ]
Firstll] b
(llb c
)llc d
.lld e
countlle j
;llj k
ifmm 
(mm 
contmm 
<mm 
$nummm 
)mm 
{nn 
varoo 
idoo 
=oo 
connoo 
.oo 
Queryoo #
(oo# $
InsertReminderoo$ 2
,oo2 3
newoo4 7
{oo8 9
userIdoo: @
=ooA B
(ooC D
longooD H
)ooH I
reminderooI Q
.ooQ R
UserIdooR X
,ooX Y
reasonooZ `
=ooa b
reminderooc k
.ook l
Remindool r
}oos t
)oot u
.oou v
Firstoov {
(oo{ |
)oo| }
.oo} ~
Id	oo~ Ä
;
ooÄ Å
awaitpp 
_redispp 
.pp 
GetDatabasepp (
(pp( )
)pp) *
.pp* +
StringSetAsyncpp+ 9
(pp9 :
$"pp: <
reminder:remove:pp< L
{ppL M
idppM O
}ppO P
"ppP Q
,ppQ R
StringppS Y
.ppY Z
EmptyppZ _
,pp_ `
reminderppa i
.ppi j
TimeSpanppj r
)ppr s
;pps t
returnqq 
trueqq 
;qq 
}rr 
elsess 
{tt 
returnuu 
falseuu 
;uu 
}vv 
}ww 	
}xx 
publicyy 

classyy 
Reminderyy 
{zz 
public{{ 
ulong{{ 
UserId{{ 
{{{ 
get{{ !
;{{! "
set{{# &
;{{& '
}{{( )
public|| 
string|| 
Remind|| 
{|| 
get|| "
;||" #
set||$ '
;||' (
}||) *
public}} 
TimeSpan}} 
TimeSpan}}  
{}}! "
get}}# &
;}}& '
set}}( +
;}}+ ,
}}}- .
}~~ 
} 